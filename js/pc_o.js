function jumboFrame(){top.iframeSize({height:"hg200"});HE.ajax({url:RouterConfig.jumbo_frame+"dispatch=show jumbo-frame&r="+Math.random(),method:"get",useXml:true},function(a){grepResult(a);var b=HE.trim.both($T(a,"jumbo-frame")[0].childNodes[0].nodeValue);if(b=="enable"){$E("jumbo1").checked=true}else{if(b=="disable"){$E("jumbo2").checked=true}}top.createButton([{id:"APPLY",func:function(){var c="";if($E("jumbo1").checked){c=$E("jumbo1").value}else{if($E("jumbo2").checked){c=$E("jumbo2").value}}HE.ajax({url:RouterConfig.jumbo_frame+"dispatch=cfg-jumbo&status="+c+"&r="+Math.random(),method:"get",useXml:true},function(e){var d=$T(e,"ret-code")[0].childNodes[0].nodeValue;if(d=="success"){window.location.reload()}else{alert($T(e,"msg")[0].childNodes[0].nodeValue)}})}},{id:"REFRESH",func:function(){window.location.reload()}}])})}function vlanTable(){var c=PM.getPara(location.href,"from");var b=PM.getPara(location.href,"to");var a=RouterConfig.vlan_table+"dispatch=show vlan range ";c=(c==""?1:c);a+=c;b=(b==""?1000:b);a+=" "+b;$("#start_vlan").val(c);$("#end_vlan").val(b);a+="&r="+Math.random();HE.ajax({url:a,method:"get",useXml:true},function(m){grepResult(m);var d={check:true,pageable:true,pagesize:100,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"VLAN ID",type:"nochangetext",cls:"wd80"},{value:"VLAN Name",type:"nochangetext",cls:"wd90"},{value:"Untag Ports",type:"nochangetext",cls:"wd90"},{value:"Tag Ports",type:"nochangetext",cls:"wd90"},{value:"",type:"nochangetext",cls:"wd90"}],max:4094,start:c,end:b};d.body=[];var f=m.getElementsByTagName("vl");if(f.length!=0){for(var k=0;k<f.length;k++){var g=f[k];var e={};e.id=g.getElementsByTagName("id")[0].childNodes[0].nodeValue;if(parseInt(e.id)=="1"){e.nocheck=true}e.data=[];e.data.push(e.id);e.data.push(g.getElementsByTagName("n")[0].childNodes[0].nodeValue);if(g.getElementsByTagName("u-port")[0].hasChildNodes()){e.data.push(g.getElementsByTagName("u-port")[0].childNodes[0].nodeValue)}else{e.data.push("")}if(g.getElementsByTagName("t-port")[0].hasChildNodes()){e.data.push(g.getElementsByTagName("t-port")[0].childNodes[0].nodeValue)}else{e.data.push("")}e.data.push('<input type="button" value="Modify" onclick="showVlan('+e.id+');" />');d.body.push(e)}}var h=HE.$("div.tablecontentbody")[1];var j=new PM.checkTable(d,h);PM.addEvent(HE.$("#btn_search_vlan"),function(){var n=$("#start_vlan");var o=$("#end_vlan");if(!PM.checkRange2(n.val(),1,4094)||!PM.checkRange2(o.val(),1,4094)||parseInt(n.val())>parseInt(o.val())){alert($("#searcherror").val());return}else{if(o.val()-n.val()>1000){alert($("#rangeerror").val())}else{var i=location.href;i=PM.setPara(i,"from",n.val());i=PM.setPara(i,"to",o.val());location.href=i}}});PM.addEvent(HE.$("#btn_all_vlan"),function(){var i=location.href;i=HE.removePara(i,"from");i=HE.removePara(i,"to");location.href=i});var l=[];l.push({id:"DELETE",func:function(){var n=j.getChecklist();var o=[];HE.array.forEach(n,function(p){if(p.checked){o.push(HE.getProp(p.parentNode.parentNode,"_id"))}});o=o.join(",");if(o==""&&$E("allcheck").checked){alert(HE.$("#defaultvlandelete").value);return}else{if(o==""){alert(HE.$("#novlanchecked").value);return}}var i=RouterConfig.vlan_table;i=HE.setPara(i,"dispatch","del-vlan");i=HE.setPara(i,"id",o);i=PM.setPara(i,"r",Math.random());$.ajax({url:i}).done(function(p){manageResult(p)})}});if(j.needPaging()){l.push({id:"NEXT",func:function(){j.nextPage()}});l.push({id:"PREV",func:function(){j.prevPage()}})}top.createButton(l)})}function vlanConfiguration(){RouterConfig.vl={};function c(){var e={"0":"ingress","1":"egress","2":"both","3":"none"};var q=[$("table:eq(1) tr:eq(0)"),$("table:eq(1) tr:eq(1)"),$("table:eq(1) tr:eq(2)"),$("table:eq(1) tr:eq(3)")];for(var k=1;k<=RouterConfig.portnum;k++){q[0].append('<th class="wd25">'+k+"</th>");for(var h=1;h<q.length;h++){q[h].append('<th class="wd25"><input type="radio" class="taArr'+h+'" name="gressradio'+k+'" value="'+e[h-1]+"_"+k+'" /></th>')}}var n=[];var r=[];RouterConfig.vl.untagradio=[];RouterConfig.vl.tagradio=[];RouterConfig.vl.notmember=[];var p=[];var o=HE.$("tr",HE.$("#table2"));for(var k=1;k<=RouterConfig.portnum;k++){var m=document.getElementsByName("gressradio"+k);RouterConfig.vl.untagradio.push(m[0]);RouterConfig.vl.tagradio.push(m[1]);RouterConfig.vl.notmember.push(m[2]);m[2].checked=true}p.push(RouterConfig.vl.untagradio);p.push(RouterConfig.vl.tagradio);p.push(RouterConfig.vl.notmember);for(var k=0;k<p.length;k++){var f=p[k];HE.array.forEach(f,function(g){PM.addEvent(g,function(){var j=[];var i=[];HE.array.forEach(RouterConfig.vl.untagradio,function(l){if(l.checked){j.push(RouterConfig.prefix+"/"+l.value.split("_")[1])}});HE.array.forEach(RouterConfig.vl.tagradio,function(l){if(l.checked){i.push(RouterConfig.prefix+"/"+l.value.split("_")[1])}});HE.$("#untags_text").value=j.join(",");HE.$("#tags_text").value=i.join(",")})})}}c();var d=HE.getPara(location.href,"id");if(d!=""){var a=RouterConfig.vlan_configuation+"dispatch=show vlan "+d+"&r="+Math.random();HE.$("#vlan_id").value=d;HE.ajax({url:a,method:"get",useXml:true},function(e){grepResult(e);var k=e.getElementsByTagName("vl");if(k.length!=0){var j=k[0];HE.$("#vlan_name").value=HE.trim.both(j.getElementsByTagName("n")[0].childNodes[0].nodeValue);var h=[];if(j.getElementsByTagName("u-port")[0].hasChildNodes()){var f=HE.trim.both(j.getElementsByTagName("u-port")[0].childNodes[0].nodeValue);var m=f.split(" ");HE.$("#untags_text").value=m.join(",");for(var g=0;g<m.length;g++){var l=m[g].split("/")[1];RouterConfig.vl.untagradio[(l-1)].checked=true}}if(j.getElementsByTagName("t-port")[0].hasChildNodes()){var f=HE.trim.both(j.getElementsByTagName("t-port")[0].childNodes[0].nodeValue);var m=f.split(" ");HE.$("#tags_text").value=m.join(",");for(var g=0;g<m.length;g++){var l=m[g].split("/")[1];RouterConfig.vl.tagradio[(l-1)].checked=true}}}})}PM.addEvent(HE.$("#vlan_refresh"),function(){if(!PM.checkRange2($("#vlan_id").val(),1,4094)){alert($("#searcherror").val());return}var e=location.href;e=HE.setPara(e,"id",HE.$("#vlan_id").value);window.location.href=e});PM.addEvent(HE.$("#vlan_apply"),function(){if(!PM.checkRange2($("#vlan_id").val(),1,4094)){alert($("#searcherror").val());return}if(!/^[\d|\w]{2,31}$|^( )*$/.test(HE.$("#vlan_name").value)){alert(HE.$("#nameerror").value);return}var e=RouterConfig.vlan_configuation;e=HE.setPara(e,"dispatch","add-vlan");e=HE.setPara(e,"id",HE.$("#vlan_id").value);e=HE.setPara(e,"name",HE.$("#vlan_name").value);e=HE.setPara(e,"untag-port",HE.$("#untags_text").value);e=HE.setPara(e,"tag-port",HE.$("#tags_text").value);e=PM.setPara(e,"r",Math.random());HE.ajax({url:e,method:"get",useXml:true},function(h){grepResult(h);var g=h.getElementsByTagName("ret-code")[0].childNodes[0].nodeValue;if(g=="success"){var f=location.href;f=HE.setPara(f,"id",HE.$("#vlan_id").value);location.href=f}else{alert(h.getElementsByTagName("msg")[0].childNodes[0].nodeValue)}})});PM.addEvent(HE.$("#untag_all"),function(){var f=[];for(var e=0;e<RouterConfig.vl.untagradio.length;e++){var g=RouterConfig.vl.untagradio[e];g.checked=true;f.push(RouterConfig.prefix+"/"+g.value.split("_")[1])}HE.$("#untags_text").value=f.join(",");HE.$("#tags_text").value=""});PM.addEvent(HE.$("#tag_all"),function(){var f=[];for(var e=0;e<RouterConfig.vl.tagradio.length;e++){var g=RouterConfig.vl.tagradio[e];g.checked=true;f.push(RouterConfig.prefix+"/"+g.value.split("_")[1])}HE.$("#tags_text").value=f.join(",");HE.$("#untags_text").value=""});PM.addEvent(HE.$("#notmember_all"),function(){for(var e=0;e<RouterConfig.vl.notmember.length;e++){var f=RouterConfig.vl.notmember[e];f.checked=true}HE.$("#tags_text").value="";HE.$("#untags_text").value=""});var b=[];top.createButton(b)}function macBasedVlan(){top.createButton({});var e={check:true,pageable:true,pagesize:100,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"MAC Address",type:"nochangetext",cls:"wd180"},{value:"VLAN ID(1-4094)",type:"nochangetext",cls:"wd180"}],body:[]};var c=location.href;var d=PM.getPara(location.href,"type");var b=RouterConfig.mac_based_vlan+"dispatch=show mac-vlan&r="+Math.random();switch(d){case"all":case"":break;case"vlan_id":var g=HE.getPara(location.href,"id");b+=" vlan "+g;break;case"mac_address":var a=HE.getPara(location.href,"address");b+=" mac-address "+a;break}f(b,$("div.tablecontentbody:eq(2)"));PM.addEvent($E("btn_add"),function(){var j=$("#add_vlan_id").val();var h=$("#add_mac_address").val();if(!PM.checkRange2(j,1,4094)){alert($("#adderror").val());return}if(!PM.checkMACAddress(h)){alert($("#searcherroraddress").val());return}var i=RouterConfig.mac_based_vlan+"dispatch=add-mac-vlan";i=HE.setPara(i,"vlan-id",j);i=HE.setPara(i,"mac_address",h);i=PM.setPara(i,"r",Math.random());HE.ajax({url:i,method:"get",useXml:true},function(k){manageResult(k)})});PM.addEvent($E("btn_search"),function(){var i=location.href;var j=$("#search_type").val();var h=$("#search_value").val();switch(j){case"":alert($("#searchnone").val());return;case"vlan_id":if(!PM.checkRange2(h,1,4094)){alert($("#searcherrorid").val());return}i=HE.setPara(i,"type","vlan_id");i=HE.setPara(i,"id",h);location.href=i;break;case"mac_address":if(h==""){alert($("#searcherroraddress").val());return}if(!PM.checkMACAddress(h)){alert($("#searcherroraddress").val());return}i=HE.setPara(i,"type","mac_address");i=HE.setPara(i,"address",h);location.href=i;break}});PM.addEvent($E("btn_all"),function(){var h=location.href;h=HE.setPara(h,"type","all");location.href=h});function f(h,i){HE.ajax({url:h,method:"get",useXml:true},function(j){grepResult(j);var l=$T(j,"mac-vlan-list")[0];var q=[];if(l.hasChildNodes()){var p=$T(l,"m-vl");for(var m=0;m<p.length;m++){var n=p[m];var r={};r.id=HE.trim.both(n.getElementsByTagName("m")[0].childNodes[0].nodeValue);r.data=[];r.data.push(r.id);r.data.push(HE.trim.both(n.getElementsByTagName("vid")[0].childNodes[0].nodeValue));e.body.push(r)}var k=new PM.checkTable(e,i);q.push({id:"DELETE",func:function(){var s=k.getChecklist();var t=[];HE.array.forEach(s,function(u){if(u.checked){t.push(HE.getProp(u.parentNode.parentNode,"_id"))}});t=t.join(",");if(t==""){alert(HE.$("#novlanchecked").value);return}var o=RouterConfig.vlan_table;o=HE.setPara(o,"dispatch","del-mac-vlan");o=HE.setPara(o,"mac-address-list",t);o=PM.setPara(o,"r",Math.random());HE.ajax({url:o,method:"get",useXml:true},function(u){manageResult(u)})}},{id:"REFRESH",func:function(){window.location.reload()}});if(k.needPaging()){q.push({id:"NEXT",func:function(){k.nextPage()}});q.push({id:"PREV",func:function(){k.prevPage()}})}}else{var k=new PM.checkTable(e,i)}top.createButton(q)})}}function flowControl(){trace(RouterConfig.privilege+">>>>>>>>>>");$.ajax({url:RouterConfig.flow_control+"dispatch=show flow-control&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var c=$T(a,"flow-control-list");var d={editable:true,check:true,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"Port",type:"nochangetext",cls:"wd54"},{value:"Flow Control",type:"select",options:[{v:"Enable",t:"Enable"},{v:"Disable",t:"Disable"}],cls:"wd90"}],body:[]};$(a).find("port").each(function(){var e={};e.id=$.trim($(this).find("id").text());e.data=[];e.data.push(e.id);e.data.push($.trim($(this).find("status").text()));d.body.push(e)});var b=new PM.checkTable(d,$("div.tablecontentbody:eq(0)"));top.createButton([{id:"REFRESH",func:function(){window.location.reload()}},{id:"APPLY",func:function(){var f=b.getChecklist();var g=[];$.each(f,function(){if($(this).attr("checked")=="checked"){g.push($(this).parent().parent().attr("_id"))}});if(g.length==0){alert(HE.$("#novlanchecked").value);return}var e=RouterConfig.flow_control;e+=decodeURIComponent($.param({dispatch:"cfg-flow-control","port-list":g.join(","),status:$("select").val(),r:Math.random()}));$.ajax({url:e,dataType:"xml"}).done(function(h){manageResult(h)})}}])})}function powerSaving(){$.ajax({url:RouterConfig.power_saving+"dispatch=show dot3az&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var c={editable:true,check:true,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"Port",type:"nochangetext",cls:"wd54"},{value:"Auto Power Down Mode",type:"nochangetext",cls:"wd140"},{value:"Short Cable Mode",type:"nochangetext",cls:"wd140"},{value:"EEE",type:"select",options:[{v:"Enable",t:"Enable"},{v:"Disable",t:"Disable"}],cls:"wd90"}],body:[]};$(a).find("port").each(function(){var d=$(this);var e={};e.id=$.trim(d.find("id").text());e.data=[];e.data.push(e.id);e.data.push($.trim(d.find("apdm").text()));e.data.push($.trim(d.find("scm").text()));e.data.push($.trim(d.find("eee").text()));c.body.push(e)});var b=new PM.checkTable(c,HE.$("div.tablecontentbody")[0]);top.createButton([{id:"REFRESH",func:function(){window.location.reload()}},{id:"APPLY",func:function(){var e=b.getChecklist();var f=[];$.each(e,function(){if($(this).attr("checked")=="checked"){f.push($(this).parent().parent().attr("_id"))}});if(f.length==0){alert(HE.$("#novlanchecked").value);return}var d=RouterConfig.flow_control;d+=decodeURIComponent($.param({dispatch:"cfg-dot3az","port-list":f.join(","),status:$("select").val(),r:Math.random()}));$.ajax({url:d,dataType:"xml"}).done(function(g){manageResult(g)})}}])})}function protocolBasedVlanConfiguration(){top.createButton({});var c={check:true,pagesize:100,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"VLAN ID(1-4094)",type:"nochangetext",cls:"wd180"},{value:"Profile ID(0-7)",type:"nochangetext",cls:"wd180"}],body:[]};var a=$.url().param("portid");a=a||"1/1";$("#port_id").val(a);var b=RouterConfig.protocol_based_vlan_configuratioin;b+="dispatch=show interface ethernet "+a+" protocol-vlan&r="+Math.random();d(b,$("div.tablecontentbody")[1]);$("#btn_add").click(function(){var e=$("#vlan_id").val();if(!PM.checkRange2(e,1,4094)){alert($("#adderror").val());return}var f=RouterConfig.protocol_based_vlan_configuratioin+decodeURIComponent($.param({dispatch:"add-protocol-based-vlan",port:$("#port_id").val(),vid:$("#vlan_id").val(),profile:$("#profile_id").val(),r:Math.random()}));PM.disableButton();$.ajax({url:f,type:"GET",dataType:"xml"}).done(function(g){manageResult(g)})});$("#port_id").change(function(){var f=$.url();var e=f.attr("base")+f.attr("path")+"?";e+=decodeURIComponent($.param({portid:$("#port_id").val()}));window.location.href=e});function d(e,f){$.ajax({url:e,type:"GET",dataType:"xml"}).done(function(g){grepResult(g);var i=[];$(g).find("protocol-vlan").each(function(){var j=$(this);var k={};k.id=$.trim(j.find("profile").text());k.data=[];k.data.push($.trim(j.find("vid").text()));k.data.push(k.id);c.body.push(k)});var h=new PM.checkTable(c,f);i.push({id:"DELETE",func:function(){if($(this).attr("disabled")){return}var k=h.getChecklist();var l=[];$.each(k,function(){if($(this).attr("checked")=="checked"){l.push($(this).parent().parent().attr("_id"))}});if(l.length==0){alert($("#novlanchecked").val());return}var j=RouterConfig.protocol_based_vlan_configuratioin+decodeURIComponent($.param({dispatch:"del-protocol-based-vlan","profile-list":l.join(","),port:$("#port_id").val(),r:Math.random()}));PM.disableButton();$.ajax({url:j,type:"GET",dataType:"xml"}).done(function(m){manageResult(m)})}},{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}});top.createButton(i)})}}function portPvidConfiguration(){$.ajax({url:RouterConfig.port_pvid_configuration+"dispatch=show interface ethernet vlan-scheme&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var c={editable:true,check:true,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"Port ID",type:"nochangetext",cls:"wd54"},{value:"Port PVID(1-4094)",type:"text",id:"port_pvid",cls:"wd140"},{value:"MAC Based VLAN",type:"select",id:"mac_based_vlan",options:[{v:"",t:""},{v:"Disable",t:"Disable"},{v:"Enable",t:"Enable"}],cls:"wd140"},{value:"Portocol Based VLAN",type:"nochangetext",cls:"wd140"}],body:[]};$(a).find("port").each(function(){var d=$(this);var e={};e.id=$.trim(d.find("id").text());e.data=[];e.data.push(e.id);e.data.push($.trim(d.find("pvid").text()));e.data.push($.trim(d.find("mac-based").text()));e.data.push($.trim(d.find("protocol-based").text()));c.body.push(e)});var b=new PM.checkTable(c,$("div.tablecontentbody")[0]);top.createButton([{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}},{id:"APPLY",func:function(){if($(this).attr("disabled")){return}if($("#port_pvid").val()!=""&&!PM.checkRange2($("#port_pvid").val(),1,4094)){alert($("#applyerror").val());return}var e=b.getChecklist();var f=[];$.each(e,function(){if($(this).attr("checked")=="checked"){f.push($(this).parent().parent().attr("_id"))}});if(f.length==0){alert($("#novlanchecked").val());return}var d=RouterConfig.port_pvid_configuration;d=PM.setPara(d,"dispatch","cfg-port-pvid");d=PM.setPara(d,"port-list",f.join(","));if($("#port_pvid").val()!=""){d=PM.setPara(d,"pvid",$("#port_pvid").val())}if($("#mac_based_vlan").val()!=""){d=PM.setPara(d,"mac_vlan_status",$("#mac_based_vlan").val())}d=PM.setPara(d,"r",Math.random());PM.disableButton();$.ajax({url:d,dataType:"xml"}).done(function(g){manageResult(g)})}}])})}function stormControl(){$.ajax({url:RouterConfig.storm_control+"dispatch=show storm-control&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var c={editable:true,check:true,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"Port",type:"nochangetext",cls:"wd54"},{value:"Unknown Unicast",type:"select",id:"status_select1",options:[{v:"",t:""},{v:"Enable",t:"Enable"},{v:"Disable",t:"Disable"}],cls:"wd140"},{value:"Unit",type:"select",id:"unit_select1",options:[{v:"",t:""},{v:"kbps",t:"kbps"},{v:"pps",t:"pps"}],cls:"wd90"},{value:"Threshold",type:"text",id:"text1",cls:"wd80"},{value:"Broadcast",type:"select",id:"status_select2",options:[{v:"",t:""},{v:"Enable",t:"Enable"},{v:"Disable",t:"Disable"}],cls:"wd140"},{value:"Unit",type:"select",id:"unit_select2",options:[{v:"",t:""},{v:"kbps",t:"kbps"},{v:"pps",t:"pps"}],cls:"wd90"},{value:"Threshold",type:"text",id:"text2",cls:"wd80"},{value:"Multicast",type:"select",id:"status_select3",options:[{v:"",t:""},{v:"Enable",t:"Enable"},{v:"Disable",t:"Disable"}],cls:"wd140"},{value:"Unit",type:"select",id:"unit_select3",options:[{v:"",t:""},{v:"kbps",t:"kbps"},{v:"pps",t:"pps"}],cls:"wd90"},{value:"Threshold",type:"text",id:"text3",cls:"wd80"}],body:[]};$(a).find("port").each(function(){var d=$(this);var e={};e.id=$.trim(d.find("id").text());e.data=[];e.data.push(e.id);e.data.push($.trim(d.find("uuc-status").text()));e.data.push($.trim(d.find("uuc-unit").text()));e.data.push($.trim(d.find("uuc-threshold").text()));e.data.push($.trim(d.find("bc-status").text()));e.data.push($.trim(d.find("bc-unit").text()));e.data.push($.trim(d.find("bc-threshold").text()));e.data.push($.trim(d.find("mc-status").text()));e.data.push($.trim(d.find("mc-unit").text()));e.data.push($.trim(d.find("mc-threshold").text()));c.body.push(e)});var b=new PM.checkTable(c,$("div.tablecontentbody")[0]);top.createButton([{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}},{id:"APPLY",func:function(){if($(this).attr("disabled")){return}var g=[];var n=[];var j=[];for(var h=1;h<=3;h++){g.push($("#status_select"+h));n.push($("#unit_select"+h));j.push($("#text"+h));if($("#status_select"+h).val()=="Enable"){var k=true;if($("#unit_select"+h).val()=="kbps"){k=PM.checkRange2($("#text"+h).val(),1,1024000)}else{if($("#unit_select"+h).val()=="pps"){k=PM.checkRange2($("#text"+h).val(),1,1488100)}else{alert($("#uniterror").val());return}}if(!k){alert($("#thrror").val());return}}}var m=b.getChecklist();var l=[];$.each(m,function(){if($(this).attr("checked")=="checked"){l.push($(this).parent().parent().attr("_id"))}});if(l.length==0){alert($("#novlanchecked").val());return}var e=RouterConfig.port_pvid_configuration;var f={dispatch:"cfg-storm-control","port-list":l.join(","),r:Math.random()};var d=["uuc_","bc_","mc_"];for(var h=0;h<g.length;h++){if(g[h].val()=="Enable"){f[d[h]+"status"]=g[h].val();f[d[h]+"unit"]=n[h].val();f[d[h]+"threshold"]=j[h].val()}else{if(g[h].val()=="Disable"){f[d[h]+"status"]=g[h].val()}}}e+=decodeURIComponent($.param(f));PM.disableButton();$.ajax({url:e,dataType:"xml"}).done(function(i){manageResult(i)})}}])})}function protocolProfile(){var b={check:true,pagesize:100,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"ID",type:"nochangetext",cls:"wd54"},{value:"Encapsulation",type:"nochangetext",cls:"wd90"},{value:"Protocol",type:"nochangetext",cls:"wd80"},{value:"Ether Type",type:"nochangetext",cls:"wd80"},{value:"DSAP",type:"nochangetext",cls:"wd80"},{value:"SSAP",type:"nochangetext",cls:"wd80"}],body:[]};$.ajax({url:RouterConfig.protocol_profile+"dispatch=show protocol-profile&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(d){grepResult(d);$(d).find("profile").each(function(){var f=$(this);var g={};g.id=$.trim(f.find("id").text());g.data=[];g.data.push(g.id);g.data.push($.trim(f.find("encapsulation").text()));g.data.push($.trim(f.find("protocol").text()));g.data.push($.trim(f.find("ethernet-type").text()));g.data.push($.trim(f.find("dsap").text()));g.data.push($.trim(f.find("ssap").text()));b.body.push(g)});var c=new PM.checkTable(b,$("div.tablecontentbody")[1]);var e=[{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}}];if(c.getChecklist().length>0){e.push({id:"DELETE",func:function(){if($(this).attr("disabled")){return}var g=c.getChecklist();var h=[];$.each(g,function(){if($(this).attr("checked")=="checked"){h.push($(this).parent().parent().attr("_id"))}});if(h.length==0){alert($("#novlanchecked").val());return}var f=RouterConfig.protocol_profile+decodeURIComponent($.param({dispatch:"del-protocol-profile","profile-list":h.join(","),r:Math.random()}));PM.disableButton();$.ajax({url:f,type:"GET",dataType:"xml"}).done(function(i){manageResult(i)})}})}top.createButton(e)});ProfileModel=Backbone.Model.extend({initialize:function(){this.sel_id=$("#sel_id");this.sel_enc=$("#sel_enc");this.sel_pro=$("#sel_pro");this.eth_type=$("#eth_type");this.dsap=$("#dsap");this.ssap=$("#ssap")},validate2:function(){if(this.sel_id.val()==""){alert($("#iderror").val());return false}if(this.sel_enc.val()==""){alert($("#encerror").val());return false}if(!this.sel_pro.attr("disabled")&&this.sel_pro.val()==""){alert($("#proerror").val());return false}if(!this.eth_type.attr("disabled")&&!/^0x[\d|a-f|A-F]{4}$/.test(this.eth_type.val())){alert($("#ethtypeerror").val());this.eth_type.val("0x");return false}if(!this.dsap.attr("disabled")&&!/^0x[\d|a-f|A-F]{2}$/.test(this.dsap.val())){alert($("#dsaperror").val());this.dsap.val("0x");return false}if(!this.ssap.attr("disabled")&&!/^0x[\d|a-f|A-F]{2}$/.test(this.ssap.val())){alert($("#ssaperror").val());this.ssap.val("0x");return false}return true}});ProfileView=Backbone.View.extend({initialize:function(c){this.el=c.el;this.render()},events:{"click input[type=button]":"add","change #sel_enc":"encapsulation","change #sel_pro":"protocol"},render:function(){this.sel_id=$("#sel_id");this.sel_enc=$("#sel_enc");this.sel_pro=$("#sel_pro");this.sel_pro.attr("disabled",true);this.eth_type=$("#eth_type");this.eth_type.attr("disabled",true);this.dsap=$("#dsap");this.dsap.attr("disabled",true);this.ssap=$("#ssap");this.ssap.attr("disabled",true);this.btn=$("#pro_add")},encapsulation:function(){if(this.sel_enc.val()=="LLC"){this.sel_pro.attr("disabled",true);this.eth_type.attr("disabled",true);this.dsap.removeAttr("disabled");this.ssap.removeAttr("disabled")}else{if(this.sel_enc.val()=="ETHERNET II"||this.sel_enc.val()=="RFC1042"){this.sel_pro.removeAttr("disabled");if(this.sel_pro.val()=="Other"){this.eth_type.attr("disabled",false)}this.dsap.attr("disabled",true);this.ssap.attr("disabled",true)}else{this.eth_type.attr("disabled",true);this.sel_pro.attr("disabled",true);this.dsap.attr("disabled",true);this.ssap.attr("disabled",true)}}},protocol:function(){switch(this.sel_pro.val()){case"":this.eth_type.attr("disabled",true);break;case"ARP":this.eth_type.val("0x0806");this.eth_type.attr("disabled",true);break;case"IPv4":this.eth_type.val("0x0800");this.eth_type.attr("disabled",true);break;case"IPv6":this.eth_type.val("0x86DD");this.eth_type.attr("disabled",true);break;case"IPX":this.eth_type.val("0x8137");this.eth_type.attr("disabled",true);break;default:this.eth_type.val("0x");this.eth_type.attr("disabled",false)}},add:function(){var e=new ProfileModel();var c=e.validate2();trace("flag="+c);if(c){PM.disableButton();$("#pro_add").attr("disabled",true);var f={dispatch:"cfg-protocol-profile",id:this.sel_id.val(),encapsulation:this.sel_enc.val(),r:Math.random()};if(!this.sel_pro.attr("disabled")){f.protocol=this.sel_pro.val()}if(!this.eth_type.attr("disabled")){f["ethernet-type"]=this.eth_type.val()}if(!this.dsap.attr("disabled")){f.dsap=this.dsap.val()}if(!this.ssap.attr("disabled")){f.ssap=this.ssap.val()}var d=RouterConfig.protocol_profile+decodeURIComponent($.param(f));$.ajax({url:d,type:"GET",dataType:"xml"}).done(function(g){manageResult(g);$("#pro_add").attr("disabled",false)})}}});var a=new ProfileView({el:$("div.tablecontentbody")[0]})}function ipConfiguration(){IPView=Backbone.View.extend({events:{"change input[type=radio]:eq(0)":"enable","change input[type=radio]:eq(1)":"disable"},initialize:function(c){this.el=c.el;this.render()},render:function(){var c=this;$.ajax({url:RouterConfig.ip_configuration+"dispatch=show ip-cfg&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(e){grepResult(e);trace($.trim($(e).find("type").text()));var d=$(e);if($.trim(d.find("type").text())=="Static"){$("input[type=radio]:eq(0)").attr("checked",true)}else{c.disable();$("input[type=radio]:eq(1)").attr("checked",true)}$("#ipaddr").val($.trim(d.find("ip-addr").text()));$("#subnet").val($.trim(d.find("sub-mask").text()));$("#gateway").val($.trim(d.find("default-gw").text()));$("#vlan_id").val($.trim(d.find("manager-vid").text()))})},enable:function(){$("#ipaddr").attr("disabled",false);$("#subnet").attr("disabled",false);$("#gateway").attr("disabled",false)},disable:function(){$("#ipaddr").attr("disabled",true);$("#subnet").attr("disabled",true);$("#gateway").attr("disabled",true)}});var b=new IPView({el:document.body});var a=[{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}}];a.push({id:"APPLY",func:function(){if($(this).attr("disabled")){return}if($("input[type=radio]:eq(0)").attr("checked")){if(!PM.checkIPAddress($("#ipaddr").val())){$("#ipaddr").val("");alert($("#ip_error").val());return}if(!PM.checkIPAddress($("#subnet").val())){$("#subnet").val("");alert($("#ip_error").val());return}if(!PM.checkIPAddress($("#gateway").val())){$("#gateway").val("");alert($("#ip_error").val());return}}if(!PM.checkRange2($("#vlan_id").val(),1,4094)){alert($("#id_error").val());return}top.popUp({title:"",height:150,width:240,type:"confirm",content:$("#apply_tips").val(),confirmfunc:function(){var d=$("input[type=radio]:eq(0)").attr("checked")?$("input[type=radio]:eq(0)").val():$("input[type=radio]:eq(1)").val();var c=RouterConfig.ip_configuration+decodeURIComponent($.param({dispatch:"cfg-ip",type:d,"ip-addr":$("#ipaddr").val(),"sub-mask":$("#subnet").val(),"default-gw":$("#gateway").val(),"manager-vid":$("#vlan_id").val(),r:Math.random()}));PM.disableButton();$.ajax({url:c,type:"GET",dataType:"xml"}).done(function(f){grepResult(f);var e=$(f).find("ret-code").text();if(e=="success"){top.location.href="http://"+$("#ipaddr").val()}else{alert($(f).find("msg").text());PM.enableButton()}})}})}});top.createButton(a)}function STPStatistics(){$.ajax({url:RouterConfig.stp_statistics+"dispatch=show stp port statistics-for-web&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var c={head:[{value:"Port",type:"nochangetext",cls:"wd54"},{value:"STP BPDUs Received",type:"nochangetext",cls:"wd80"},{value:"STP BPDUs Transmitted",type:"nochangetext",cls:"wd80"},{value:"RSTP BPDUs Received",type:"nochangetext",cls:"wd80"},{value:"RSTP BPDUs Transmitted",type:"nochangetext",cls:"wd80"}],body:[]};trace(a);$(a).find("port").each(function(){var d=$(this);var e={};e.id=$.trim(d.find("id").text());e.data=[];e.data.push(e.id);e.data.push($.trim(d.find("stp-bpdu-recv").text()));e.data.push($.trim(d.find("stp-bpdu-trans").text()));e.data.push($.trim(d.find("rstp-bpdu-recv").text()));e.data.push($.trim(d.find("rstp-bpdu-trans").text()));c.body.push(e)});var b=new PM.checkTable(c,$("div.tablecontentbody")[0]);top.createButton([{id:"REFRESH",func:function(){window.location.reload()}}])})}function STPPortStatus(){$.ajax({url:RouterConfig.stp_port_status+"dispatch=show stp port status-for-web&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var c={head:[{value:"Port",type:"nochangetext",cls:"wd54"},{value:"Port Protocol",type:"nochangetext",cls:"wd80"},{value:"Port Role",type:"nochangetext",cls:"wd80"},{value:"Port Status",type:"nochangetext",cls:"wd80"},{value:"P2P Admin/Oper",type:"nochangetext",cls:"wd80"},{value:"Edge Admin/Oper",type:"nochangetext",cls:"wd80"}],body:[]};trace(a);$(a).find("port").each(function(){var d=$(this);var e={};e.id=$.trim(d.find("id").text());e.data=[];e.data.push(e.id);e.data.push($.trim(d.find("port-protocol").text()));e.data.push($.trim(d.find("port-role").text()));e.data.push($.trim(d.find("port-status").text()));e.data.push($.trim(d.find("p2p").text()));e.data.push($.trim(d.find("edge").text()));c.body.push(e)});var b=new PM.checkTable(c,$("div.tablecontentbody")[0]);top.createButton([{id:"REFRESH",func:function(){window.location.reload()}}])})}function portStatistics(){$.ajax({url:RouterConfig.port_statistics+"dispatch=show port-statistic&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var c={check:true,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"Port",type:"nochangetext",cls:"wd54"},{value:"InOctets",type:"nochangetext",cls:"wd80"},{value:"InUcastPkts",type:"nochangetext",cls:"wd80"},{value:"InNUcastPkts",type:"nochangetext",cls:"wd80"},{value:"InDiscard",type:"nochangetext",cls:"wd80"},{value:"InError",type:"nochangetext",cls:"wd80"},{value:"OutOctets",type:"nochangetext",cls:"wd80"},{value:"OutUcastPkts",type:"nochangetext",cls:"wd80"},{value:"OutNUcastPkts",type:"nochangetext",cls:"wd80"},{value:"OutDiscard",type:"nochangetext",cls:"wd80"},{value:"OutError",type:"nochangetext",cls:"wd80"}],body:[]};trace(a);$(a).find("port").each(function(){var d=$(this);var e={};e.id=$.trim(d.find("id").text());e.data=[];e.data.push(e.id);e.data.push($.trim(d.find("inoctets").text()));e.data.push($.trim(d.find("inucastpkts").text()));e.data.push($.trim(d.find("innucastpkts").text()));e.data.push($.trim(d.find("indiscards").text()));e.data.push($.trim(d.find("inerrors").text()));e.data.push($.trim(d.find("outoctets").text()));e.data.push($.trim(d.find("outucastpkts").text()));e.data.push($.trim(d.find("outnucastpkts").text()));e.data.push($.trim(d.find("outdiscards").text()));e.data.push($.trim(d.find("outerrors").text()));c.body.push(e)});var b=new PM.checkTable(c,$("div.tablecontentbody")[0]);top.createButton([{id:"REFRESH",func:function(){window.location.reload()}},{id:"CLEAR",func:function(){if($(this).attr("disabled")){return}var e=b.getChecklist();var f=[];$.each(e,function(){if($(this).attr("checked")=="checked"){f.push($(this).parent().parent().attr("_id"))}});if(f.length==0){alert($("#novlanchecked").val());return}var d=RouterConfig.port_statistics;d=PM.setPara(d,"dispatch","clear-port-stats");d=PM.setPara(d,"port-list",f.join(","));d=PM.setPara(d,"r",Math.random());$.ajax({url:d,type:"GET",dataType:"xml"}).done(function(g){$(this).attr("disabled",false);manageResult(g)})}}])})}function deviceReboot(){checkLoginStatus();top.createButton([{id:"APPLY",func:function(){if($("#reboot_check").attr("checked")){top.popUp({title:"",height:90,width:240,type:"confirm",content:$("#tips").val(),confirmfunc:function(){var a=RouterConfig.device_reboot+"dispatch=cfg-reboot&r="+Math.random();$.ajax({url:a,dataType:"xml",timeout:10*1000}).done(function(b){PM.tmpflag=true;grepResult(b);if($(b).find("ret-code").text()=="error"){alert($(b).find("msg").text())}else{top.checkServer(function(){top.window.location.href=$.url().attr("base")});top.watisTips()}});setTimeout(function(){if(PM.tmpflag){return}top.checkServer(function(){top.window.location.href=$.url().attr("base")});top.watisTips()},1000*10)}})}else{alert($("#nocheck_tips").val())}}},{id:"CLEAR",func:function(){$("#reboot_check").attr("checked",false)}}])}function STPPortConfiguration(){$.ajax({url:RouterConfig.stp_port_configuration+"dispatch=show-stp-port&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var c={editable:true,check:true,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"Port",type:"nochangetext",cls:"wd54"},{value:"Port Priority",type:"text",id:"port-priority",cls:"wd120"},{value:"Path Cost (0=auto)",type:"text",id:"path-cost",cls:"wd120"},{value:"Port Role",type:"nochangetext",cls:"wd120"},{value:"Port State",type:"nochangetext",cls:"wd140"},{value:"NonSTP",type:"select",id:"nonstp",options:[{v:"",t:""},{v:"Y",t:"Y"},{v:"N",t:"N"}],cls:"wd90"},{value:"P2P",type:"select",id:"p2p",options:[{v:"",t:""},{v:"Y",t:"Y"},{v:"N",t:"N"}],cls:"wd90"},{value:"Edge",type:"select",id:"edge",options:[{v:"",t:""},{v:"Y",t:"Y"},{v:"N",t:"N"}],cls:"wd90"},{value:"Designated Bridge",type:"nochangetext",cls:"wd200"},{value:"Designated Port",type:"nochangetext",cls:"wd200"}],body:[]};$(a).find("port").each(function(){var d=$(this);var e={};e.id=$.trim(d.find("id").text());e.data=[];e.data.push(e.id);e.data.push($.trim(d.find("port-priority").text()));e.data.push($.trim(d.find("path-cost").text()));e.data.push($.trim(d.find("port-role").text()));e.data.push($.trim(d.find("port-state").text()));e.data.push($.trim(d.find("nonstp").text()));e.data.push($.trim(d.find("p2p").text()));e.data.push($.trim(d.find("edge").text()));e.data.push($.trim(d.find("designated-bridge").text()));e.data.push($.trim(d.find("designated-port").text()));c.body.push(e)});var b=new PM.checkTable(c,HE.$("div.tablecontentbody")[0]);top.createButton([{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}},{id:"APPLY",func:function(){if($(this).attr("disabled")){return}var g=b.getChecklist();var j=[];$.each(g,function(){if($(this).attr("checked")=="checked"){j.push($(this).parent().parent().attr("_id"))}});if(j.length==0){alert($("#novlanchecked").val());return}var h=$("#port-priority").val();if(h!=""&&(!PM.checkRange2(h,0,240)||h%16!=0)){alert($("#port_priority_error").val());return}var k=$("#path-cost").val();if(k!=""&&!PM.checkRange2(k,0,20000000)){alert($("#port_cost_error").val());return}var d=RouterConfig.stp_port_configuration;d=PM.setPara(d,"dispatch","cfg-stp-port");d=PM.setPara(d,"port-list",j.join(","));var f=["port-priority","path-cost","nonstp","p2p","edge"];for(var e=0;e<f.length;e++){if($("#"+f[e]).val()!=""){d=PM.setPara(d,f[e],$("#"+f[e]).val())}}d=PM.setPara(d,"r",Math.random());top.popUp({height:140,width:280,content:$("#confirm_tips").val(),type:"confirm",confirmfunc:function(){PM.disableButton();top.watisTips();setInterval(function(){$.ajax({url:d,dataType:"xml",timeout:3*1000}).done(function(i){window.location.reload();top.closeTips()})},4*1000)}})}}])})}function TFTPUpgrade(){checkLoginStatus();top.createButton([{id:"CLEAR",func:function(){$("#tftp_server").val("");$("#file_name").val("");$("#file_type").val("Application")}},{id:"APPLY",func:function(){var b=$("#tftp_server").val();if(!PM.checkIPAddress(b)){alert(RouterConfig.error.iperror);return}var c=$("#file_name").val();if(c==""||/(\\|\/|\:|\*|<|>|\||\"|\?| )/.test(c)||c.length<1||c.length>64){alert($("#nameerror").val());return}var a=RouterConfig.tftp_upgrade;a+=decodeURIComponent($.param({dispatch:"cfg-tftp","server-ip":b,"file-type":$("#file_type").val(),"file-name":c,r:Math.random()}));top.popUp({height:120,width:260,textOk:"Sure",textCancel:"Cancel",content:$("#confirm_tips").val(),type:"confirm",confirmfunc:function(){top.watisTips();$.ajax({url:a,dataType:"xml",timeout:180*1000}).done(function(e){grepResult(e);top.closeTips();var d=$(e).find("ret-code").text();if(d=="success"){top.popUp({height:120,width:260,textOk:"Yes",textCancel:"No",content:$("#jump_tips").val(),type:"confirm",confirmfunc:function(){window.location.href=RouterConfig.orgData.Maintenance.Reset["Device Reboot"]}})}else{alert($(e).find("msg").text())}})}})}}])}function systemInformation(){$.ajax({url:RouterConfig.system_information+"dispatch=show sys-info&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var c={},b={};c.sys_name=$.trim($(a).find("sys-name").text());c.sys_location=$.trim($(a).find("sys-location").text());c.sys_contact=$.trim($(a).find("sys-contact").text());c.serial_number=$.trim($(a).find("serial-number").text());c.sys_obj_id=$.trim($(a).find("sys-obj-id").text());c.date_time=$.trim($(a).find("date-time").text());c.sys_up_time=$.trim($(a).find("sys-up-time").text());c.base_mac_addr=$.trim($(a).find("base-mac-addr").text());trace(c);b.model_name=$.trim($(a).find("model-name").text());b.boot_version=$.trim($(a).find("boot-version").text());b.soft_version=$.trim($(a).find("soft-version").text());$("div.tablecontentbody:eq(0)").html(_.template($("#infos").html(),c));$("div.tablecontentbody:eq(1)").html(_.template($("#vers").html(),b));top.createButton([{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}},{id:"APPLY",func:function(){if($(this).attr("disabled")){return}var e=/^[a-zA-Z0-9_]{1,19}$/;if(!e.test($("input:eq(0)").val())){alert($("#nameerr").val());return}if(!e.test($("input:eq(1)").val())){alert($("#locaerr").val());return}if(!e.test($("input:eq(2)").val())){alert($("#conterr").val());return}var d=RouterConfig.system_information;d+=decodeURIComponent($.param({dispatch:"cfg-sysinfo",name:$("input:eq(0)").val(),location:$("input:eq(1)").val(),Contact:$("input:eq(2)").val(),r:Math.random()}));$.ajax({url:d}).done(function(f){manageResult(f)})}}])})}function STPGlobalConfiguration(){$.ajax({url:RouterConfig.stp_global_configuration+"dispatch=show-stp-global&r="+Math.random()}).done(function(a){grepResult(a);var c={};c.identifier=$.trim($(a).find("bridge-identifier").text());c.time_since=$.trim($(a).find("time-sin-last-topology-change").text());c.desginated_root=$.trim($(a).find("designated-root").text());c.root_port=$.trim($(a).find("root-port").text());c.root_path_cost=$.trim($(a).find("root-path-cost").text());c.max_age=$.trim($(a).find("root-max-age").text());c.forward_delay=$.trim($(a).find("root-forward-delay").text());c.hello_time=$.trim($(a).find("root-hello-time").text());$("div.tablecontentbody:eq(1)").html(_.template($("#stp_status").html(),c));var b={};b.pri=$.trim($(a).find("bridge-pri").text());b.max_age=$.trim($(a).find("bridge-max-age").text());b.hello_time=$.trim($(a).find("bridge-hello-time").text());b.forward_delay=$.trim($(a).find("bridge-forward-delay").text());b.trans_limit=$.trim($(a).find("trans-limit").text());$("div.tablecontentbody:eq(0)").html(_.template($("#global_setting").html(),b));$("select:eq(0)").val($.trim($(a).find("status").text()));$("select:eq(1)").val($.trim($(a).find("mode").text()));top.createButton([{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}},{id:"APPLY",func:function(){if($(this).attr("disabled")){return}if(!PM.checkRange2($("input:eq(0)").val(),0,61440)||$("input:eq(0)").val()%4096!=0||!PM.checkRange2($("input:eq(1)").val(),6,40)||!PM.checkRange2($("input:eq(2)").val(),1,10)||!PM.checkRange2($("input:eq(3)").val(),4,30)){alert($("#numerror").val());return}if(2*(parseInt($("input:eq(3)").val())-1)<$("input:eq(1)").val()||$("input:eq(1)").val()<2*(parseInt($("input:eq(2)").val())+1)){alert($("#relationerr").val());return}var d=RouterConfig.stp_global_configuration;d+=decodeURIComponent($.param({dispatch:"cfg-stp-global",sts:$("select:eq(0)").val(),stm:$("select:eq(1)").val(),bp:$("input:eq(0)").val(),bma:$("input:eq(1)").val(),bht:$("input:eq(2)").val(),bfd:$("input:eq(3)").val(),r:Math.random()}));top.popUp({height:120,width:260,textOk:"Sure",textCancel:"Cancel",content:$("#confirm_tips").val(),type:"confirm",confirmfunc:function(){top.watisTips();$.ajax({url:d}).done(function(e){top.closeTips();if($(e).find("ret-code").text()!="success"){alert($(e).find("msg").text())}});setInterval(function(){$.ajax({url:RouterConfig.stp_global_configuration+"dispatch=show-stp-global"}).done(function(e){grepResult(e);top.closeTips();if($(e).find("bridge-identifier").length>0){window.location.reload()}})},5*1000)}})}}])})}function staticMacAddress(){var d=$("select:eq(0)");for(var a=1;a<=RouterConfig.portnum;a++){d.append('<option value="'+RouterConfig.prefix+"/"+a+'">'+RouterConfig.prefix+"/"+a+"</option>")}var c={check:true,pagesize:100,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"MAC Address",type:"nochangetext",cls:"wd120"},{value:"VLAN ID(1-4094)",type:"nochangetext",cls:"wd90"},{value:"Port",type:"nochangetext",cls:"wd80"},{value:"Type",type:"nochangetext",cls:"wd80"}],body:[]};$.ajax({url:RouterConfig.static_mac_address+"dispatch=show fdb static&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(f){grepResult(f);$(f).find("r").each(function(){var h=$(this);var i={};i.id=$.trim(h.find("mc").text());i.data=[];i.data.push(i.id);i.data.push($.trim(h.find("vid").text()));i.data.push($.trim(h.find("p").text()));i.data.push($.trim(h.find("t").text()));c.body.push(i)});var e=new PM.checkTable(c,$("div.tablecontentbody")[1]);var g=[{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}}];if(e.getChecklist().length>0){g.push({id:"DELETE",func:function(){if($(this).attr("disabled")){return}var j=e.getChecklist();var k=[];var h=[];$.each(j,function(){if($(this).attr("checked")=="checked"){k.push($(this).parent().parent().attr("_id"));h.push($(this).parent().next().next().html())}});if(k.length==0){alert($("#novlanchecked").val());return}var i=RouterConfig.static_mac_address+decodeURIComponent($.param({dispatch:"del-static-mac","mac-addr-list":k.join(","),"vid-list":h.join(",")}));PM.disableButton();$.ajax({url:i,type:"GET",dataType:"xml"}).done(function(l){manageResult(l)})}})}if(e.needPaging()){g.push({id:"NEXT",func:function(){e.nextPage()}});g.push({id:"PREV",func:function(){e.prevPage()}})}top.createButton(g)});StaticMACModel=Backbone.Model.extend({initialize:function(){this.port=$("select:eq(0)");this.type=$("select:eq(1)");this.address=$("input:eq(0)");this.vid=$("input:eq(1)")},validate2:function(){if(!PM.checkMACAddress(this.address.val())){alert($("#addresserror").val());return false}if(!PM.checkRange2(this.vid.val(),1,4094)){alert($("#viderror").val());return false}return true}});StaticMACView=Backbone.View.extend({initialize:function(){},events:{"click input[type=button]":"add","change select:eq(1)":"change"},add:function(){var g=new StaticMACModel();var e=g.validate2();if(e){PM.disableButton();$("#pro_add").attr("disabled",true);var h={dispatch:"add-static-mac","mac-addr":g.address.val(),vid:g.vid.val(),port:g.port.val(),type:g.type.val(),r:Math.random()};var f=RouterConfig.static_mac_address+decodeURIComponent($.param(h));$.ajax({url:f,type:"GET",dataType:"xml"}).done(function(i){manageResult(i);$("#pro_add").attr("disabled",false)})}},change:function(){if($(this.el).find("select:eq(1)").val()=="Blackhole"){$(this.el).find("select:eq(0)").attr("disabled",true)}else{$(this.el).find("select:eq(0)").attr("disabled",false)}}});var b=new StaticMACView({el:$("div.tablecontentbody:eq(0)")})}function macTable(){var f={pagesize:100,head:[{value:"VLAN ID",type:"nochangetext",cls:"wd90"},{value:"MAC Address",type:"nochangetext",cls:"wd120"},{value:"Port",type:"nochangetext",cls:"wd80"},{value:"Type",type:"nochangetext",cls:"wd80"}],body:[]};var b=RouterConfig.mac_table+"dispatch=show fdb";var a=window.location.href;var c=PM.getPara(a,"type");var e=PM.getPara(a,"value");if(c!=""){b+=" "+c+" "+e;$("select").val(c);$("input[type=text]").val(e)}b+="&r="+Math.random();$.ajax({url:b,type:"GET",dataType:"xml"}).done(function(h){grepResult(h);$(h).find("r").each(function(){var j=$(this);var k={};k.id=$.trim(j.find("vid").text());k.data=[];k.data.push(k.id);k.data.push($.trim(j.find("mc").text()));k.data.push($.trim(j.find("p").text()));k.data.push($.trim(j.find("t").text()));f.body.push(k)});var g=new PM.checkTable(f,$("div.tablecontentbody")[1]);var i=[{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}}];if(g.needPaging()){i.push({id:"NEXT",func:function(){g.nextPage()}});i.push({id:"PREV",func:function(){g.prevPage()}})}top.createButton(i)});MACTableModel=Backbone.Model.extend({initialize:function(){this.type=$("select");this.value=$("input[type=text]")},validate2:function(){switch(this.type.val()){case"vlan":if(!PM.checkRange2(this.value.val(),1,4094)){alert($("#viderror").val());return false}break;case"mac-address":if(!PM.checkMACAddress(this.value.val())){alert($("#addresserror").val());return false}break;case"port":if(!/^1\/[\d]{1,2}$/.test(this.value.val())||!PM.checkRange2(this.value.val().split("/")[1],1,RouterConfig.portnum)){alert($("#porterror").val());return false}break;default:alert($("#filtertype").val());return false}return true}});MACTableView=Backbone.View.extend({initialize:function(){this.render()},render:function(){this.model=new MACTableModel()},events:{"click input[type=button]:eq(0)":"doFilter","click input[type=button]:eq(1)":"doClear"},doFilter:function(){var g=this.model.validate2();if(g){PM.disableButton();$("#pro_add").attr("disabled",true);$("#pro_clear").attr("disabled",true);trace($.url());var h=window.location.href;h=PM.setPara(h,"type",this.model.type.val());h=PM.setPara(h,"value",this.model.value.val());window.location.href=h}},doClear:function(){var i=this;var g=this.model.validate2();var h="";if(g){switch(this.model.type.val()){case"vlan":h="in VLAN ";break;case"port":h="on port ";break}h+=this.model.value.val();top.popUp({height:120,width:260,textOk:"Sure",textCancel:"Cancel",content:_.template($("#confirm_tips").html(),{variable:h}),type:"confirm",confirmfunc:function(){PM.disableButton();$("#pro_add").attr("disabled",true);$("#pro_clear").attr("disabled",true);var j=RouterConfig.mac_table+decodeURIComponent($.param({dispatch:"clear-fdb",type:i.model.type.val(),value:i.model.value.val(),r:Math.random()}));$.ajax({url:j}).done(function(l){grepResult(l);if($(l).find("ret-code").text()=="success"){var k=window.location.href;k=PM.removePara(k,"type");k=PM.removePara(k,"value");window.location.href=k}else{alert($(l).find("msg").text());$("#pro_add").attr("disabled",false);$("#pro_clear").attr("disabled",false);PM.enableButton()}})}})}}});var d=new MACTableView({el:$("div.tablecontentbody:eq(0)")})}function portBasic(){var a=RouterConfig.port_basic+"dispatch=show port basic&r="+Math.random();$.ajax({url:a}).done(function(c){grepResult(c);var d={editable:true,check:true,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"Port",type:"nochangetext",cls:"wd54"},{value:"Admin Mode",type:"select",options:[{v:"",t:""},{v:"Enable",t:"Enable"},{v:"Disable",t:"Disable"}],cls:"wd90"},{value:"Port Speed",type:"select",options:[{v:"",t:""},{v:"Auto",t:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Auto"},{v:"10Mbps Half Duplex",t:"10Mbps Half Duplex"},{v:"10Mbps Full Duplex",t:"10Mbps Full Duplex"},{v:"100Mbps Half Duplex",t:"100Mbps Half Duplex"},{v:"100Mbps Full Duplex",t:"100Mbps Full Duplex"},{v:"1000Mbps Full Duplex",t:"1000Mbps Full Duplex"}],cls:"wd90"},{value:"Physical Status",type:"nochangetext",cls:"wd90"},{value:"Link Status",type:"nochangetext",cls:"wd90"},{value:"Maximum Frame Length",type:"nochangetext",size:"6",cls:"wd140"},{value:"PVID",type:"nochangetext",cls:"wd54"}],body:[]};$(c).find("interface").each(function(){var e=$(this);var f={};f.id=$.trim(e.find("ifname").text());f.data=[];f.data.push(f.id);f.data.push($.trim(e.find("adm-mode").text()));f.data.push($.trim(e.find("port-speed").text()));f.data.push($.trim(e.find("phy-st").text()));f.data.push($.trim(e.find("link-st").text()));f.data.push($.trim(e.find("mtu").text()));f.data.push($.trim(e.find("pvid").text()));d.body.push(f)});trace(d);var b=new PM.checkTable(d,$("div.tablecontentbody:eq(0)"));top.createButton([{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}},{id:"APPLY",func:function(){if($(this).attr("disabled")){return}var g=b.getChecklist();var h=[];$.each(g,function(){if($(this).attr("checked")=="checked"){h.push($(this).parent().parent().attr("_id"))}});if(h.length==0){alert($("#novlanchecked").val());return}var i={dispatch:"cfg-port-basic","port-list":h.join(","),r:Math.random()};var f=$("div.tablecontentbody:eq(0)");if(f.find("select:eq(0)").val()!=""){i["admin-mode"]=f.find("select:eq(0)").val()}var e=RouterConfig.port_basic+decodeURIComponent($.param(i));if(f.find("select:eq(1)").val()!=""){e+="&speed="+f.find("select:eq(1)").val()}PM.disableButton();$.ajax({url:e,type:"GET",dataType:"xml"}).done(function(j){setTimeout(function(){manageResult(j)},2*1000)})}}])})}function globalMacSettings(){var a=RouterConfig.global_mac_settings+"dispatch=show fdb-aging-learning&r="+Math.random();$.ajax({url:a}).done(function(b){grepResult(b);$("#ag_time").val($.trim($(b).find("aging-time").text()));$("select").val($.trim($(b).find("mac-learning").text()));$("#time_apply").click(function(){if(!PM.checkRange2($("#ag_time").val(),10,1000000)){alert($("#timeerr").val());return}var c=RouterConfig.global_mac_settings+"dispatch=cfg-fdb-aging&aging-time="+$("#ag_time").val()+"&r="+Math.random();$.ajax({url:c}).done(function(d){manageResult(d)})});$("#learning_apply").click(function(){if($("select").val()==""){alert($("#learningerr").val());return}var c=RouterConfig.global_mac_settings+"dispatch=cfg-fdb-learnig&status="+$("select").val()+"&r="+Math.random();$.ajax({url:c}).done(function(d){manageResult(d)})})});top.createButton([{id:"REFRESH",func:function(){window.location.reload()}}])}function Ping(){checkLoginStatus();top.createButton([{id:"APPLY",func:function(){if(!PM.checkIPAddress($("#ip_address").val())&&!PM.checkHostname($("#ip_address").val())){alert($("#chkip_host_err").val());return}if(!PM.checkRange2($("#count").val(),1,15)){alert($("#counterror").val());return}if(!PM.checkRange2($("#size").val(),8,12000)){alert($("#sizeerror").val());return}$("textarea").val("");var a=RouterConfig.ping+decodeURIComponent($.param({dispatch:"cfg-ping",ip:$("#ip_address").val(),count:$("#count").val(),size:$("#size").val(),r:Math.random()}));top.watisTips();$.ajax({url:a}).done(function(b){top.closeTips();grepResult(b);if($(b).find("ret-code").text()=="error"){alert($(b).find("msg").text())}else{$("textarea").val($(b).find("msg").text());$("#ip_address").val("")}})}}])}function traceRoute(){checkLoginStatus();top.createButton([{id:"APPLY",func:function(){if(!PM.checkIPAddress($("#ip_address").val())&&!PM.checkHostname($("#ip_address").val())){alert($("#chkip_host_err").val());return}if(!PM.checkRange2($("#probe").val(),1,10)){alert($("#probeerr").val());return}if(!PM.checkRange2($("#ttl").val(),1,30)){alert($("#ttlerr").val());return}if(!PM.checkRange2($("#udp").val(),1,65535)){alert($("#udperr").val());return}if(!PM.checkRange2($("#interv").val(),1,10)){alert($("#inteverr").val());return}$("textarea").val("");var a=RouterConfig.traceroute+decodeURIComponent($.param({dispatch:"cfg-traceroute",ip:$("#ip_address").val(),probe:$("#probe").val(),maxttl:$("#ttl").val(),port:$("#udp").val(),interval:$("#interv").val(),r:Math.random()}));top.watisTips();$.ajax({url:a}).done(function(b){grepResult(b);top.closeTips();if($(b).find("ret-code").text()=="error"){alert($(b).find("msg").text())}else{$("textarea").val($(b).find("msg").text());$("#ip_address").val("")}})}}])}function userManagement(){var a=RouterConfig.user_management+"dispatch=show all-userinfo&r="+Math.random();$.ajax({url:a}).done(function(c){grepResult(c);$("#btn_add").click(function(){if(!/[\d|\w]{1,31}/.test($("#user_name").val())){alert($("#nameerr").val());return}if(!/\S{1,20}/.test($("#pwd").val())){alert($("#pwderr").val());return}var e=RouterConfig.user_management+"dispatch=add-userinfo";e=PM.setPara(e,"name",$("#user_name").val());e=PM.setPara(e,"pwd",$("#pwd").val());e=PM.setPara(e,"privilege",$("select").val());e=PM.setPara(e,"r",Math.random());$.ajax({url:e}).done(function(f){manageResult(f)})});var d={check:true,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"User Name",type:"nochangetext",cls:"wd300"},{value:"Privilege",type:"nochangetext",cls:"wd120"}],body:[{id:"admin",data:["admin","Configure"],nocheck:true}]};$(c).find("user-info").each(function(){var f=$.trim($(this).find("name").text());if(f!="admin"){var e={};e.id=f;e.data=[e.id,$.trim($(this).find("privilege").text())];d.body.push(e)}});var b=new PM.checkTable(d,$("div.tablecontentbody")[1]);top.createButton([{id:"DELETE",func:function(){var f=b.getChecklist();var g=[];$.each(f,function(){if($(this).attr("checked")=="checked"){g.push($(this).parent().parent().attr("_id"))}});if(g.length==0&&$("#allcheck").attr("checked")=="checked"){alert($("#defaultvlandelete").val());return}else{if(g.length==0){alert($("#nochecked").val());return}}var e=RouterConfig.user_management;e=PM.setPara(e,"dispatch","del-userinfo");e=PM.setPara(e,"name-list",g.join(","));e=PM.setPara(e,"r",Math.random());$.ajax({url:e}).done(function(h){manageResult(h)})}},{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}}])})}function portIsolation(){var b={"0":"ingress","1":"egress","2":"both","3":"none"};var f=[$("table:eq(1) tr:eq(0)"),$("table:eq(1) tr:eq(1)"),$("table:eq(1) tr:eq(2)"),$("table:eq(1) tr:eq(3)"),$("table:eq(1) tr:eq(4)")];for(var d=1;d<=RouterConfig.portnum;d++){f[0].append('<th class="wd25">'+d+"</th>");for(var c=1;c<f.length;c++){f[c].append('<th class="wd25"><input type="radio" class="taArr'+c+'" name="gressradio'+d+'" value="'+b[c-1]+"_"+d+'" /></th>')}}var a=PM.getPara(location.href,"group");if(a!=""){$.ajax({url:RouterConfig.port_isolation+"dispatch=show isol-group "+a+"&r="+Math.random()}).done(function(g){var h=new PortIsolation(g,{group:a,table1:$("#table1"),table2:$("#table2"),table3:$("#table3")});top.createButton([{id:"APPLY",func:function(){h.submit()}},{id:"REFRESH",func:function(){window.location.reload()}}])})}else{var e=$("#sel_group").change(function(){var h=$(this).val();var g=location.href;if(h!=""){g=PM.setPara(g,"group",h)}else{g=PM.removePara(g,"group")}window.location.href=g});top.createButton([{id:"APPLY",func:function(){},cls:"disable"},{id:"REFRESH",func:function(){},cls:"disable"}])}}function DNSHostConfiguration(){$.ajax({url:RouterConfig.dns_host_configuration+"dispatch=how-dns-host-config&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var d={check:true,pageable:true,pagesize:100,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"Host Name",type:"nochangetext",cls:"wd300"},{value:"Host IP",type:"nochangetext",cls:"wd180"}],body:[]};$(a).find("r").each(function(){var e={};e.id=$.trim($(this).find("host-name").text());e.data=[];e.data.push(e.id);e.data.push($.trim($(this).find("host-ip").text()));d.body.push(e)});var b=new PM.checkTable(d,$("div.tablecontentbody:eq(1)"));var c=[{id:"REFRESH",func:function(){window.location.reload()}},{id:"ADD",func:function(){var e=$("#host_name").val();var f=$("#host_ip").val();if(!e.match(/^[\w|\d|\-|\.]{1,255}$/ig)){alert($("#host_name_err").val());return}if(!PM.checkIPAddress(f)){alert($("#host_ip_err").val());return}var g=g=RouterConfig.dns_server_configuration;g=PM.setPara(g,"dispatch","add-dns-hostconfig");g=PM.setPara(g,"host-name",e);g=PM.setPara(g,"host-ip",f);g=PM.setPara(g,"r",Math.random());$.ajax({url:g,dataType:"xml"}).done(function(h){manageResult(h)})}},{id:"DELETE",func:function(){var f=$("div.tablecontentbody:eq(1)");var g=b.getChecklist();var h=[];var i=[];$.each(g,function(){if($(this).attr("checked")=="checked"){var j=$(this).parent().parent();h.push(j.attr("_id"));i.push(j.find(":last-child").text())}});if(h.length==0){alert($("#novlanchecked").val());return}var e=RouterConfig.dns_host_configuration;e=PM.setPara(e,"dispatch","del-dns-hostconfig");e=PM.setPara(e,"host-name-list",h.join(","));e=PM.setPara(e,"host-ip-list",i.join(","));e=PM.setPara(e,"r",Math.random());$.ajax({url:e,dataType:"xml"}).done(function(j){manageResult(j)})}}];if(b.needPaging()){c.push({id:"NEXT",func:function(){b.nextPage()}});c.push({id:"PREV",func:function(){b.prevPage()}})}top.createButton(c)})}function DNSServerConfiguration(){$.ajax({url:RouterConfig.dns_server_configuration+"dispatch=show-dns-server-config&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var d={check:true,pageable:true,pagesize:100,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"DNS Server IP",type:"nochangetext",cls:"wd180"}],body:[]};$(a).find("server-ip").each(function(){var e={};e.id=$.trim($(this).text());e.data=[];e.data.push(e.id);d.body.push(e)});var b=new PM.checkTable(d,$("div.tablecontentbody:eq(1)"));var c=[{id:"REFRESH",func:function(){window.location.reload()}},{id:"ADD",func:function(){var e=$("#dns_id").val();if(!PM.checkIPAddress(e)){alert($("#dns_id_err").val());return}var f=f=RouterConfig.dns_server_configuration;f=PM.setPara(f,"dispatch","add-dns-server");f=PM.setPara(f,"dns-server-ip",e);f=PM.setPara(f,"r",Math.random());$.ajax({url:f,dataType:"xml"}).done(function(g){manageResult(g)})}},{id:"DELETE",func:function(){var f=$("div.tablecontentbody:eq(1)");var g=b.getChecklist();var h=[];$.each(g,function(){if($(this).attr("checked")=="checked"){h.push($(this).parent().parent().attr("_id"))}});if(h.length==0){alert($("#novlanchecked").val());return}var e=RouterConfig.dns_server_configuration;e=PM.setPara(e,"dispatch","del-dns-server");e=PM.setPara(e,"dns-server-ip-list",h.join(","));e=PM.setPara(e,"r",Math.random());$.ajax({url:e,dataType:"xml"}).done(function(i){manageResult(i)})}}];if(b.needPaging()){c.push({id:"NEXT",func:function(){b.nextPage()}});c.push({id:"PREV",func:function(){b.prevPage()}})}top.createButton(c)})}function IGMPQuerierVLANConfiguration(){$.ajax({url:RouterConfig.igmp_querier+"dispatch=show igmp-querier-vlan-cfg&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var d={editable:true,check:true,pageable:true,pagesize:50,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"VLAN ID",type:"nochangetext",cls:"wd54"},{value:"Query Mode",type:"select",options:[{v:"",t:""},{v:"Enable",t:"Enable"},{v:"Disable",t:"Disable"}],cls:"wd90"},{value:"Query Interval",type:"text",cls:"wd90"},{value:"Maximum Response Time",type:"text",cls:"wd120"},{value:"Last Member Query Interval",type:"text",cls:"wd140"},{value:"Snooping Querier SIP",type:"text",cls:"wd180"}],body:[]};$(a).find("vlan").each(function(){var e={};e.id=$.trim($(this).find("vid").text());e.data=[];e.data.push(e.id);e.data.push($.trim($(this).find("mode").text()));e.data.push($.trim($(this).find("query-inval").text()));e.data.push($.trim($(this).find("max-response-time").text()));e.data.push($.trim($(this).find("last-member-query-inval").text()));e.data.push($.trim($(this).find("sip").text()));d.body.push(e)});var b=new PM.checkTable(d,$("div.tablecontentbody:eq(0)"));var c=[{id:"REFRESH",func:function(){window.location.reload()}},{id:"APPLY",func:function(){var f=$("div.tablecontentbody:eq(0)");var k=b.getChecklist();var i=[];$.each(k,function(){if($(this).attr("checked")=="checked"){i.push($(this).parent().parent().attr("_id"))}});if(i.length==0){alert($("#novlanchecked").val());return}var g=f.find("input[type=text]:eq(0)").val();if(g!=""&&!PM.checkRange2(g,2,300)){alert($("#querierintervalerr").val());return}var m=f.find("input[type=text]:eq(1)").val();if(m!=""&&!PM.checkRange2(m,1,25)){alert($("#mrterr").val());return}var j=f.find("input[type=text]:eq(2)").val();if(j!=""&&!PM.checkRange2(j,1,5)){alert($("#lmqierr").val());return}var l=f.find("input[type=text]:eq(3)").val();if(l!=""&&!PM.checkIPAddress(l)){alert($("#sqserr").val());return}var e=RouterConfig.igmp_querier;e=PM.setPara(e,"dispatch","cfg-vlan-igmp-querier");e=PM.setPara(e,"vid",i.join(","));e=PM.setPara(e,"r",Math.random());if(f.find("select:eq(0)").val()!=""){e=PM.setPara(e,"mode",f.find("select:eq(0)").val())}var h=["query-inval","max-response-time","last-member-query-inval","sip"];$.each(h,function(o){var n=f.find("input[type=text]:eq("+o+")").val();if(n!=""){e=PM.setPara(e,h[o],n)}});$.ajax({url:e,dataType:"xml"}).done(function(n){manageResult(n)})}}];if(b.needPaging()){c.push({id:"NEXT",func:function(){b.nextPage()}});c.push({id:"PREV",func:function(){b.prevPage()}})}top.createButton(c)})}function IGMPSnoopingVLANConfiguration(){$("#add_vlan").click(function(){var a=$("#vlan_id").val();if(!PM.checkRange2(a,1,4094)){alert($("#vlan_id_err").val());return}var b=b=RouterConfig.igmp_snooping;b=PM.setPara(b,"dispatch","igmp-vlan-add");b=PM.setPara(b,"vid",a);b=PM.setPara(b,"r",Math.random());$.ajax({url:b,dataType:"xml"}).done(function(c){manageResult(c)})});$.ajax({url:RouterConfig.igmp_snooping+"dispatch=show igmp-vlan-cfg&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var d={editable:true,check:true,pageable:true,pagesize:50,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"VLAN ID",type:"nochangetext",cls:"wd54"},{value:"Host Timeout",type:"text",cls:"wd90"},{value:"MRouter Timeout",type:"text",cls:"wd90"},{value:"Drop Unknown Multicast",type:"select",options:[{v:"",t:""},{v:"Enable",t:"Enable"},{v:"Disable",t:"Disable"}],cls:"wd120"},{value:"IGMP Version",type:"select",options:[{v:"",t:""},{v:"1",t:"1"},{v:"2",t:"2"}],cls:"wd140"}],body:[]};$(a).find("vlan").each(function(){var e={};e.id=$.trim($(this).find("vid").text());e.data=[];e.data.push(e.id);e.data.push($.trim($(this).find("host-time").text()));e.data.push($.trim($(this).find("mrouter-time").text()));e.data.push($.trim($(this).find("drop-unknow").text()));e.data.push($.trim($(this).find("version").text()));d.body.push(e)});var b=new PM.checkTable(d,$("div.tablecontentbody:eq(1)"));var c=[{id:"REFRESH",func:function(){window.location.reload()}},{id:"APPLY",func:function(){var h=$("div.tablecontentbody:eq(1)");var j=b.getChecklist();var l=[];$.each(j,function(){if($(this).attr("checked")=="checked"){l.push($(this).parent().parent().attr("_id"))}});if(l.length==0){alert($("#novlanchecked").val());return}var g=h.find("input[type=text]:eq(0)").val();if(g!=""&&!PM.checkRange2(g,200,1000)){alert($("#host_timeout_err").val());return}var i=h.find("input[type=text]:eq(1)").val();if(i!=""&&!PM.checkRange2(i,1,1000)){alert($("#mrouter_timeout_err").val());return}var f=RouterConfig.igmp_snooping;f=PM.setPara(f,"dispatch","cfg-igmp-vlan");f=PM.setPara(f,"vid",l.join(","));var e=["drop-unknown","version"];$.each(e,function(m){var n=h.find("select:eq("+m+")").val();if(n!=""){f=PM.setPara(f,e[m],n)}});var k=["host-time","mroute-time"];$.each(k,function(n){var m=h.find("input[type=text]:eq("+n+")").val();if(m!=""){f=PM.setPara(f,k[n],m)}});f=PM.setPara(f,"r",Math.random());$.ajax({url:f,dataType:"xml"}).done(function(m){manageResult(m)})}},{id:"DELETE",func:function(){var f=$("div.tablecontentbody:eq(1)");var g=b.getChecklist();var h=[];$.each(g,function(){if($(this).attr("checked")=="checked"){h.push($(this).parent().parent().attr("_id"))}});if(h.length==0){alert($("#novlanchecked").val());return}var e=e=RouterConfig.igmp_snooping;e=PM.setPara(e,"dispatch","igmp-vlan-del");e=PM.setPara(e,"vid-list",h.join(","));$.ajax({url:e,dataType:"xml"}).done(function(i){manageResult(i)})}}];if(b.needPaging()){c.push({id:"NEXT",func:function(){b.nextPage()}});c.push({id:"PREV",func:function(){b.prevPage()}})}top.createButton(c)})}function IGMPSnoopingConfiguration(){$.ajax({url:RouterConfig.igmp_snooping_configuration+"dispatch=show-igmp-cfg&r="+Math.random()}).done(function(a){grepResult(a);var b={};b.status=$.trim($(a).find("status").text());b.rev_gen_queries=$.trim($(a).find("rev-gen-queries").text());b.rev_igmpv2_report=$.trim($(a).find("rev-igmpv2-report").text());b.rev_igmpv1_report=$.trim($(a).find("rev-igmpv1-report").text());b.sent_gen_queries=$.trim($(a).find("sent-gen-queries").text());b.sent_grp_spe_queries=$.trim($(a).find("sent-grp-spe-queries").text());b.rev_igmp_leaves=$.trim($(a).find("rev-igmp-leaves").text());b.rev_grp_spe_queries=$.trim($(a).find("rev-grp-spe-queries").text());b.cur_igmp_grp=$.trim($(a).find("cur-igmp-grp").text());b.cur_igmp_vlan=$.trim($(a).find("cur-igmp-vlan").text());$("div.tablecontentbody:eq(0)").html(_.template($("#igmp_snooping_configuration").html(),b));$("div.tablecontentbody:eq(1)").html(_.template($("#igmp_statistics_tmpl").html(),b));$("div.tablecontentbody:eq(2)").html(_.template($("#igmp_snooping_capacity_tmpl").html(),b));top.createButton([{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}},{id:"APPLY",func:function(){if($(this).attr("disabled")){return}var c=RouterConfig.igmp_snooping_configuration;c=PM.setPara(c,"dispatch","cfg-igmp-global");c=PM.setPara(c,"igmp-sts",$('input[name="igmp_status"]:checked').val());var d=$('input[name="clear_sts"]:checked').val();d=="Yes"?c=PM.setPara(c,"clear-sts",d):"";c=PM.setPara(c,"r",Math.random());$.ajax({url:c}).done(function(e){grepResult(e)})}}])})}function IGMPSnoopingTable(){var b={pagesize:50,head:[{value:"VLAN ID",type:"nochangetext",cls:"wd90"},{value:"Group MAC Address",type:"nochangetext",cls:"wd170"},{value:"Group IP Address",type:"nochangetext",cls:"wd140"},{value:"Router Port(s)",type:"nochangetext",cls:"wd140"},{value:"Member Port(s)",type:"nochangetext",cls:"wd140"}],body:[]};var a=PM.getUrl(RouterConfig.igmp_snooping_table)+"?dispatch=how igmp-table";$.ajax({url:a,type:"GET",dataType:"xml"}).done(function(d){grepResult(d);$(d).find("r").each(function(){var f=$(this);var g={};g.id=$.trim(f.find("vid").text());g.data=[];g.data.push(g.id);g.data.push($.trim(f.find("grp-mac").text()));g.data.push($.trim(f.find("grp-ip").text()));g.data.push($.trim(f.find("router-ports").text()));g.data.push($.trim(f.find("member-ports").text()));b.body.push(g)});var c=new PM.checkTable(b,$("div.tablecontentbody:eq(0)"));var e=[{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}}];if(c.needPaging()){e.push({id:"NEXT",func:function(){c.nextPage()}});e.push({id:"PREV",func:function(){c.prevPage()}})}top.createButton(e)})}function LACPConfiguration(){var a=[{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}PM.disableButton();var b=$(".tablecontentbody input:eq(0)");if(!PM.checkRange2(b.val(),0,65536)){alert($("#err").val());PM.enableButton();return}var c=PM.getUrl(RouterConfig.lacp_configuration)+"?dispatch=show lacp priority load";c=PM.setPara(c,"priority",b.val());$.ajax({url:c,type:"GET",dataType:"xml"}).done(function(d){grepResult(d);if($(d).find("ret-code").length>0){alert($(d).find("msg").text())}else{$(".tablecontentbody input:eq(0)").val($.trim($(d).find("lacp-sys-priority").text()));$(".tablecontentbody select:eq(0)").val($.trim($(d).find("lacp-load-balance").text()))}PM.enableButton()})}},{id:"APPLY",func:function(){if($(this).attr("disabled")){return}PM.disableButton();var c=$(".tablecontentbody input:eq(0)");if(!PM.checkRange2(c.val(),0,65536)){alert($("#err").val());PM.enableButton();return}var b=PM.getUrl(RouterConfig.lacp_configuration)+"?dispatch=cfg-lag-sys-priority";b=PM.setPara(b,"priority",c.val());b=PM.setPara(b,"sys-load-balance",$(".tablecontentbody select:eq(0)").val());$.ajax({url:b,type:"GET",dataType:"xml"}).done(function(d){manageResult(d)})}}];top.createButton(a)}function lacpPortConfigruation(){var a=RouterConfig.lacp_port_configuration+"dispatch=show lacp-port-priority&r="+Math.random();$.ajax({url:a}).done(function(c){grepResult(c);var d={editable:true,check:true,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"Port ID",type:"nochangetext",cls:"wd54"},{value:"LACP Priority (0-255)",type:"text",cls:"wd120"},{value:"Time",type:"select",options:[{v:"",t:""},{v:"Long",t:"Long"},{v:"Short",t:"Short"}],cls:"wd90"}],body:[]};$(c).find("port").each(function(){var e=$(this);var f={};f.id=$.trim(e.find("id").text());f.data=[];f.data.push(f.id);f.data.push($.trim(e.find("priority").text()));f.data.push($.trim(e.find("time-out").text()));d.body.push(f)});var b=new PM.checkTable(d,$("div.tablecontentbody:eq(0)"));top.createButton([{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}},{id:"APPLY",func:function(){if($(this).attr("disabled")){return}var h=b.getChecklist();var j=[];$.each(h,function(){if($(this).attr("checked")=="checked"){j.push($(this).parent().parent().attr("_id"))}});if(j.length==0){alert($("#novlanchecked").val());return}var e=RouterConfig.port_basic;e=PM.setPara(e,"dispatch","cfg-lag-priority");e=PM.setPara(e,"port-list",j.join(","));var g=$("div.tablecontentbody:eq(0)");var f=g.find("input[type=text]:eq(0)").val();if(f!=""){e=PM.setPara(e,"priority",f)}var i=g.find("select:eq(0)").val();if(i!=""){e=PM.setPara(e,"timeout",i)}PM.disableButton();$.ajax({url:e,type:"GET",dataType:"xml"}).done(function(k){manageResult(k)})}}])})}function LAGGroupTable(){var a=RouterConfig.lag_group_table+"dispatch=show lag-group-table";a+="&r="+Math.random();HE.ajax({url:a,method:"get",useXml:true},function(b){grepResult(b);var e={check:true,pageable:true,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"Group ID",type:"nochangetext",cls:"wd80"},{value:"LAG Mode",type:"nochangetext",cls:"wd90"},{value:"Loadsharing Type",type:"nochangetext",cls:"wd90"},{value:"Selected Port(s)",type:"nochangetext",cls:"wd90"},{value:"Unselected Port(s)",type:"nochangetext",cls:"wd90"},{value:"",type:"nochangetext",cls:"wd90"}]};e.body=[];var d=[];if($(b).find("grp").length>0){$(b).find("grp").each(function(){var g=$(this);var h={};h.id=$.trim(g.find("grp-id").text());h.data=[];h.data.push(h.id);h.data.push($.trim(g.find("mod").text()));h.data.push($.trim(g.find("loadsharing-type").text()));h.data.push($.trim(g.find("sel-port-list").text()));h.data.push($.trim(g.find("unsel-port-list").text()));e.body.push(h);h.data.push('<input type="button" value="Modify" onclick="ModifyLAG('+h.id+');" />');e.body.push(h)})}var f=$("div.tablecontentbody")[0];var c=new PM.checkTable(e,f);d.push({id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}},{id:"DELETE",func:function(){if($(this).attr("disabled")){return}var h=c.getChecklist();var i=[];$.each(h,function(){if($(this).attr("checked")=="checked"){i.push($(this).parent().parent().attr("_id"))}});if(i.length==0){alert($("#novlanchecked").val());return}var g=RouterConfig.lag_group_table;g=PM.setPara(g,"dispatch","del-lag");g=PM.setPara(g,"group-list",i.join(","));g=PM.setPara(g,"r",Math.random());PM.disableButton();$.ajax({url:g,dataType:"xml"}).done(function(j){manageResult(j)})}});top.createButton(d)})}function advancedShapingConfiguration(){$.ajax({url:RouterConfig.advanced_shaping_configuration+"dispatch=show-port-shaping-config&r="+Math.random(),type:"GET",dataType:"xml"}).done(function(a){grepResult(a);var c={editable:true,check:true,head:[{value:"",type:"checkbox",id:"allcheck",cls:"wd15"},{value:"Port",type:"nochangetext",cls:"wd54"},{value:"Port Shaping(64-1000000)",type:"text",id:"port-shaping",cls:"wd90"},{value:"Queue1 (0=auto)",type:"text",id:"q1",cls:"wd90"},{value:"Queue2 (0=auto)",type:"text",id:"q2",cls:"wd90"},{value:"Queue3 (0=auto)",type:"text",id:"q3",cls:"wd90"},{value:"Queue4 (0=auto)",type:"text",id:"q4",cls:"wd90"},{value:"Queue5 (0=auto)",type:"text",id:"q5",cls:"wd90"},{value:"Queue6 (0=auto)",type:"text",id:"q6",cls:"wd90"},{value:"Queue7 (0=auto)",type:"text",id:"q7",cls:"wd90"},{value:"Queue8 (0=auto)",type:"text",id:"q8",cls:"wd90"}],body:[]};$(a).find("r").each(function(){var d=$(this);var f={};f.id=$.trim(d.find("port-id").text());f.data=[];f.data.push(f.id);f.data.push($.trim(d.find("port-shaping").text()));for(var e=1;e<=8;e++){f.data.push($.trim(d.find("q"+e).text()))}c.body.push(f)});var b=new PM.checkTable(c,$("div.tablecontentbody")[0]);top.createButton([{id:"REFRESH",func:function(){if($(this).attr("disabled")){return}window.location.reload()}},{id:"APPLY",func:function(){if($(this).attr("disabled")){return}var f=b.getChecklist();var g=[];$.each(f,function(){if($(this).attr("checked")=="checked"){g.push($(this).parent().parent().attr("_id"))}});if(g.length==0){alert($("#novlanchecked").val());return}if($("#port-shaping").val()!=""&&!PM.checkRange2($("#port-shaping").val(),64,1000000)){alert($("#shapingerr").val());return}for(var e=1;e<=8;e++){if($("#q"+e).val()!=""&&$("#q"+e).val()!="0"&&!PM.checkRange2($("#q"+e).val(),64,1000000)){alert("Please input valid Queue"+e+" Number!");return}}var d=RouterConfig.advanced_shaping_configuration;d=PM.setPara(d,"dispatch","qos-shaping-cfg");d=PM.setPara(d,"port-list",g.join(","));if($("#port-shaping").val()!=""){d=PM.setPara(d,"port-shaping",$("#port-shaping").val())}for(var e=1;e<=8;e++){if($("#q"+e).val()!=""){d=PM.setPara(d,"q"+e,$("#q"+e).val())}}d=PM.setPara(d,"r",Math.random());PM.disableButton();$.ajax({url:d,dataType:"xml"}).done(function(h){manageResult(h)})}}])})};