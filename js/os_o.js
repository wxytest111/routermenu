function $E(b){var a=typeof b=="string"?document.getElementById(b):b;if(a!=null){return a}else{}return null}function $C(a){return document.createElement(a)}function $N(a){return document.getElementsByName(a)}function $T(b,a){return b.getElementsByTagName(a)}$extend=function(a,d,b){for(var c in d){if(b!=null){if(!a[c]){a[c]=d[c]}}else{a[c]=d[c]}}return a};var PM={};PM.create=function(){return function(){this.initialize.apply(this,arguments)}};PM.getPara=function(c,b){var d="",a=b+"=";if(c.indexOf("&"+a)>-1){d=c.split("&"+a)[1].split("&")[0]}if(c.indexOf("?"+a)>-1){d=c.split("?"+a)[1].split("&")[0]}return d};PM.setPara=function(d,c,e){d=$.trim(d);var b=c+"="+e;d=PM.removePara(d,c);var a=PM.getPara(d,c);return a==""?(d+((d.indexOf("?")<0)?"?":"&")+b):d.replace("&"+c+"="+a,"&"+b).replace("?"+c+"="+a,"?"+b)};PM.removePara=function(c,b){if(!b){return c}var a=PM.getPara(c,b);if(c.indexOf("&"+b+"="+a)>-1){c=c.replace("&"+b+"="+a,"")}else{if(c.indexOf("?"+b+"="+a+"&")>-1){c=c.replace(b+"="+a+"&","")}else{c=c.replace("?"+b+"="+a,"")}}return c};(function(c){var d=navigator.userAgent.toLowerCase();c.$IE=/msie/.test(d);c.$OPERA=/opera/.test(d);c.$MOZ=/gecko/.test(d);c.$IE5=/msie 5 /.test(d);c.$IE55=/msie 5.5/.test(d);c.$IE6=/msie 6/.test(d);c.$IE7=/msie 7/.test(d);c.$IE8=/msie 8/.test(d);c.$SAFARI=/safari/.test(d);c.$FF2=/Firefox\/2/i.test(d);c.$FF=/firefox/i.test(d);c.$CHROME=/chrome/i.test(d);c.$TT=/tencenttraveler/.test(d);c.$360=/360se/.test(d);c.$Maxthon=false;try{var a=window.external;c.$Maxthon=a.max_version?true:false}catch(b){}})(PM);PM.$e=function(a){return document.getElementById(a)};PM.$c=function(a){return document.createElement(a)};PM.addEvent=function(f,d,c,a){var e=typeof f=="string"?PM.$e(f):f;if(e==null){trace("addEvent can not find object："+f);return}if(typeof a=="undefined"){a=false}if(typeof c=="undefined"){c="click"}if(e.addEventListener){e.addEventListener(c,d,a);return true}else{if(e.attachEvent){var b=e.attachEvent("on"+c,d);return true}else{e["on"+c]=d}}};PM.removeEvent=function(d,b,a){var c=typeof d=="string"?PM.$e(d):d;if(c==null){trace("removeEvent can not find object："+oElement);return}if(typeof b!="function"){return}if(typeof a=="undefined"){a="click"}if(c.addEventListener){c.removeEventListener(a,b,false)}else{if(c.attachEvent){c.detachEvent("on"+a,b)}}c[a]=null};PM.bindFunc=function(b,c){var a=b;return function(){return a.apply(c,arguments)}};PM.getLeft=function(a){var b=0;if(typeof a.offsetParent!="unknown"){while(a.offsetParent){b+=a.offsetLeft;a=a.offsetParent}}else{if(a.x){b+=a.x}}return b};PM.getTop=function(a){var b=0;if(typeof a.offsetParent!="unknown"){while(a.offsetParent){b+=a.offsetTop;a=a.offsetParent}}else{if(a.y){b+=a.y}}return b};PM.insertHTML=function(d,c,b){d=d||document.body;b=b.toLowerCase()||"beforeend";if(d.insertAdjacentHTML){switch(b){case"beforebegin":d.insertAdjacentHTML("BeforeBegin",c);return d.previousSibling;case"afterbegin":d.insertAdjacentHTML("AfterBegin",c);return d.firstChild;case"beforeend":d.insertAdjacentHTML("BeforeEnd",c);return d.lastChild;case"afterend":d.insertAdjacentHTML("AfterEnd",c);return d.nextSibling}}var a=d.ownerDocument.createRange();var e;switch(b){case"beforebegin":a.setStartBefore(d);e=a.createContextualFragment(c);d.parentNode.insertBefore(e,d);return d.previousSibling;case"afterbegin":if(d.firstChild){a.setStartBefore(d.firstChild);e=a.createContextualFragment(c);d.insertBefore(e,d.firstChild);return d.firstChild}else{d.innerHTML=c;return d.firstChild}break;case"beforeend":if(d.lastChild){a.setStartAfter(d.lastChild);e=a.createContextualFragment(c);d.appendChild(e);return d.lastChild}else{d.innerHTML=c;return d.lastChild}break;case"afterend":a.setStartAfter(d);e=a.createContextualFragment(c);d.parentNode.insertBefore(e,d.nextSibling);return d.nextSibling}};PM.setCookie=function(b,f,c,j,e,a){var g=[];g.push(b+"="+escape(f));if(c){var h=new Date();var d=h.getTime()+c*3600000;h.setTime(d);g.push("expires="+h.toGMTString())}if(j){g.push("path="+j)}if(e){g.push("domain="+e)}if(a){g.push(a)}document.cookie=g.join(";")};PM.getCookie=function(a){a=a.replace(/([\.\[\]\$])/g,"\\$1");var c=new RegExp(a+"=([^;]*)?;","i");var d=document.cookie+";";var b=d.match(c);if(b){return b[1]||""}else{return""}};PM.min=function(d,c){return d>c?c:d};PM.max=function(d,c){return d>c?d:c};PM.checkTable=PM.create();PM.checkTable.prototype={data:{},cnt:null,checknum:0,pageable:false,pagesize:0,total:0,page:1,initialize:function(b,a){if(typeof b=="string"){b=$.parseJSON(b)}this.data=b;this.pageabe=(this.data.pageable?true:false);this.total=this.data.body.length;this.pagesize=parseInt(this.data.pagesize?(this.data.pagesize>this.total?this.total:this.data.pagesize):this.total);this.totalpage=Math.ceil(this.total/this.pagesize);if(!a){return}this.cnt=a;this.createTable();this.createHead();this.createBody(this.page);this.setEvent()},createTable:function(){_this=this;$(this.cnt).html('<table align="center" rules="groups" border="0" cellspacing="1" cellpadding="1"><thead></thead><tbody></tbody></table>');this.table=$(this.cnt).find("table:first");trace($(this.table).html());this.thead=$(this.cnt).find("thead:first");this.tbody=$(this.cnt).find("tbody:first")},createHead:function(){var g=PM.$c("tr");var d=PM.$c("tr");d.className="normalfont";for(var e=0;e<this.data.head.length;e++){var b=this.data.head[e];if(!this.data.check&&b.type=="checkbox"){continue}else{var a=PM.$c("th");a.className=b.cls;a.innerHTML=b.value;g.appendChild(a);if(!this.data.editable&&b.type=="checkbox"){var h=PM.$c("input");h.type="checkbox";h.id=b.id||"allcheck";this.allcheck=h;a.appendChild(h)}}if(this.data.editable){switch(b.type){case"checkbox":var k=PM.$c("th");var h=PM.$c("input");h.type="checkbox";h.id=b.id||"allcheck";this.allcheck=h;k.appendChild(h);d.appendChild(k);break;case"nochangetext":var k=PM.$c("th");k.innerHTML="";d.appendChild(k);break;case"text":var k=PM.$c("th");var h=PM.$c("input");h.type="text";h.size=b.size||8;if(b.id){h.id=b.id}k.appendChild(h);d.appendChild(k);break;case"select":var k=PM.$c("th");var f="<select";if(b.id){f+=' id="'+b.id+'" '}f+=">";for(var c=0;c<b.options.length;c++){f+='<option value="'+b.options[c].v+'">'+b.options[c].t+"</option>"}f+="</select>";k.innerHTML=f;d.appendChild(k);break;default:}}}$(this.thead).append($(g));if(this.data.check){$(this.thead).append($(d))}},createBody:function(e){if(this.data.check){this.checklist=[]}this.removeEvent();$(this.tbody).html("");for(var b=(e-1)*this.pagesize;b<PM.min(e*this.pagesize,this.total);b++){var f=this.data.body[b];trace(f);var d=PM.$c("tr");if(b%2==0){d.className="oddrows"}$(d).attr("_id",f.id||"");if(this.data.check){var g=PM.$c("td");d.appendChild(g);var c=PM.$c("input");c.type="checkbox";c.id="chk_"+f.id||"";if(!f.nocheck){this.checklist[this.checklist.length]=c;g.appendChild(c)}}for(var a=0;a<f.data.length;a++){var g=PM.$c("td");g.innerHTML=f.data[a]||"";d.appendChild(g)}$(this.tbody).append($(d))}},setEvent:function(){if(!this.data.editable&&!this.data.check){return}var a=this;PM.addEvent(this.allcheck,PM.bindFunc(this.allCheckEvent,this));HE.array.forEach(this.checklist,function(b){PM.addEvent(b,function(){PM.ChangeRowColor(b);if(b.checked){a.checknum++;HE.addClass(b.parentNode.parentNode,"selectRow");if(a.checknum>1){a.resetLine()}else{a.addDataToLine(b.parentNode.parentNode)}}else{a.checknum--;if(a.checknum<1){a.resetLine()}else{if(a.checknum==1){var c=a.findCheckedOne();a.addDataToLine(c.parentNode.parentNode)}}HE.removeClass(b.parentNode.parentNode,"selectRow");allcheck.checked=""}})})},allCheckEvent:function(){trace("allCheckEvent");if(this.allcheck.checked){HE.array.forEach(this.checklist,function(a){a.checked="true";HE.addClass(a.parentNode.parentNode,"selectRow")});this.checknum=this.checklist.length;this.resetLine()}else{HE.array.forEach(this.checklist,function(a){a.checked="";HE.removeClass(a.parentNode.parentNode,"selectRow")});this.checknum=0}},removeEvent:function(){if(!this.data.check){return}this.allcheck.checked=false;PM.removeEvent(this.allcheck,this.allCheckEvent)},nextPage:function(){if(this.data.end&&this.data.end<this.data.max&&this.page==this.totalpage){var b=window.location.href;var c=parseInt(this.data.end)+1;var a=Math.min((parseInt(this.data.end)+1000),this.data.max);b=PM.setPara(b,"from",c);b=PM.setPara(b,"to",a);window.location.href=b}if(this.page==this.totalpage){return}this.page++;this.createBody(this.page)},prevPage:function(){if(this.data.start&&this.data.start>1&&this.page==1){var b=window.location.href;var c=Math.max((parseInt(this.data.start)-1000),1);var a=parseInt(this.data.start)-1;b=PM.setPara(b,"from",c);b=PM.setPara(b,"to",a);window.location.href=b}if(this.page==1){return}this.page--;this.createBody(this.page)},findCheckedOne:function(){for(var a=0;a<this.checklist.length;a++){if(this.checklist[a].checked){return this.checklist[a]}}},addDataToLine:function(d){if(!this.data.editable){return}trace("add data to line");trace(d);var c=$(d).find("td");var a=$(this.thead).find(".normalfont th");for(var b=0;b<this.data.head.length;b++){var e=this.data.head[b];switch(e.type){case"checkbox":break;case"nochangetext":trace($(c[b]).html());$(a[b]).html($(c[b]).html());break;case"text":trace($(c[b]).html());$(a[b]).find("input:first").val($(c[b]).html());break;case"select":this.getSelectBox($(c[b]).html(),$(a[b]).find("select:first"));break;default:}}},clearDataToLine:function(){if(!this.data.editable){return}var a=$(this.thead).find(".normalfont th");for(var b=0;b<this.data.head.length;b++){var c=this.data.head[b];switch(c.type){case"checkbox":break;case"nochangetext":$(a[b]).html("");break;case"text":$(a[b]).find("input:first").val("");break;case"select":this.getSelectBox("None",$(a[b]).find("select").first());break;default:}}},resetLine:function(){if(!this.data.editable){return}var a=$(this.thead).find(".normalfont th");for(var b=0;b<this.data.head.length;b++){var c=this.data.head[b];switch(c.type){case"checkbox":break;case"nochangetext":$(a[b]).html("");break;case"text":$(a[b]).find("input").first().val("");break;case"select":this.getSelectBox("None",$(a[b]).find("select").first());break;default:}}},getSelectBox:function(a,b){b.val(a);return},getChecklist:function(){return this.checklist},getPageInfo:function(){return{page:this.page,totalpage:this.totalpage}},needPaging:function(){trace(this.total);trace(this.pagesize);return this.total>this.pagesize}};PM.normalTable=PM.create();PM.normalTable.prototype={data:{},cnt:null,checknum:0,initialize:function(b,a){if(typeof b=="string"){b=HE.json2Obj(b)}this.data=b;trace("init");if(!a){return}this.cnt=a;this.createTable();this.createBody();this.setEvent()},createTable:function(){trace("go");_this=this;$(this.cnt).html('<table align="center" border="0" cellspacing="1" cellpadding="1" class="'+(this.data.cls||"")+'"></table>');this.table=HE.$("table",this.cnt)[0];this.thead=HE.$("thead",this.table)[0];this.tbody=HE.$("tbody",this.table)[0]},createHead:function(){var c=PM.$c("tr");var e=PM.$c("tr");e.className="normalfont";for(var a=0;a<this.data.head.length;a++){var d=this.data.head[a];var b=PM.$c("th");b.className=d.cls;b.innerHTML=d.value;c.appendChild(b)}this.table.appendChild(c)},createBody:function(){for(var g=0;g<this.data.body.length;g++){var a=this.data.body[g];var l=PM.$c("tr");for(var c=0;c<a.length;c++){var d=PM.$c("td");var b=a[c];d.className=b.cls||"";if(b.clospan){d.colSpan=b.clospan}trace(b.type);switch(b.type){case"checkbox":var n=PM.$c("input");n.type="checkbox";n.id=b.id||"allcheck";d.appendChild(n);break;case"nochangetext":d.innerHTML=b.value;break;case"button":var n=PM.$c("input");n.type="button";n.value=b.value;if(b.funcs){for(var e in b.funcs){n["on"+e]=b.funcs[e]}}d.appendChild(n);break;case"text":var n=PM.$c("input");n.type="text";n.size=b.size||8;n.value=b.value;d.appendChild(n);break;case"select":var h="<select>";for(var f=0;f<b.options.length;f++){h+='<option value="'+b.options[f].v+'">'+b.options[f].t+"</option>"}h+="</select>";d.innerHTML=h;break}l.appendChild(d)}this.table.appendChild(l)}},setEvent:function(){},getSelectBox:function(b,c){for(var a=0;a<c.options.length;a++){if(c.options[a].value==b){c.selectedIndex=a}}},getChecklist:function(){}};PM.checkRange=function(c,a,b){c.value=c.value.replace(/\D/gi,"");while(c.value!=""&&(c.value>b||c.value<a)){c.value=c.value.slice(0,-1)}};PM.checkRange2=function(b,a,c){if(!/^\-{0,1}\d+$/gi.test(b)){return false}if(b>c||b<a){return false}else{return true}};PM.checkMACAddress=function(a){if(/^[\da-fA-F]{4}\.[\da-fA-F]{4}\.[\da-fA-F]{4}$/.test(a)&&!/^0{4}\.0{4}\.0{4}$/.test(a)&&/^[\da-fA-F]{1}[0|2|4|6|8|A|a|C|c|E|e]/.test(a)){return true}return false};PM.checkIPAddress=function(a){if(/^[\d]{1,3}\.[\d]{1,3}\.[\d]{1,3}\.[\d]{1,3}$/.test(a)&&!/^0{1,3}\.0{1,3}\.0{1,3}\.0{1,3}$/.test(a)){return true}return false};PM.checkHostname=function(a){if(/^[\w|\d|\-|\.]{1,255}$/gi.test(a)&&!(/^\-/gi.test(a)||/\-$/gi.test(a)||/.*\-\-.*/gi.test(a))){return true}return false};PM.getUrl=function(b){var a=b+"r="+Math.random();return a};PM.ChangeRowColor=function(a){var b=a.parentNode.parentNode;if(HE.hasClass(b,"selectRow")){HE.removeClass(b,"selectRow")}else{HE.addClass(b,"selectRow")}};PM.enableButton=function(){if(arguments.length==0){$.each(top.$("#btnarea a"),function(){$(this).removeClass("disable").attr("disabled",false)});return}for(i=0;i<arguments.length;i++){top.$("#"+arguments[i]).removeClass("disable").attr("disabled",false)}};PM.disableButton=function(){if(arguments.length==0){$.each(top.$("#btnarea a"),function(){$(this).addClass("disable").attr("disabled",true)});return}for(i=0;i<arguments.length;i++){top.$("#"+arguments[i]).addClass("disable").attr("disabled",true)}};PortMirror=PM.create();PortMirror.prototype={initialize:function(a,d){var g=this;this.radiomap={ingress:0,egress:1,both:2,none:3};this.radiomap2={"0":"ingress","1":"egress","2":"both","3":"none"};this.group=d.group;this.table1=d.table1;this.table2=d.table2;this.table3=d.table3;this.result=a;this.prefix=RouterConfig.prefix;this.length=RouterConfig.portnum;this.ingress_str="";this.egress_str="";this.both_str="";this.ingress_text=$("#ingress_text");this.egress_text=$("#egress_text");this.both_text=$("#both_text");this.sel_group=$("#sel_group");this.sel_status=$("#sel_status");this.sel_analy_port1=$("#sel_analy_port1");this.sel_analy_port2=$("#sel_analy_port2");this.sel_analy_dir1=$("#sel_analy_dir1");this.sel_analy_dir2=$("#sel_analy_dir2");this.trArr=[$("table:eq(1) tr:eq(0)"),$("table:eq(1) tr:eq(1)"),$("table:eq(1) tr:eq(2)"),$("table:eq(1) tr:eq(3)"),$("table:eq(1) tr:eq(4)")];this.genreateDOM();this.analyarr=new Array(3);this.gressarr=[new Array((this.length+1)),new Array((this.length+1)),new Array((this.length+1)),new Array((this.length+1))];for(var c=0;c<this.gressarr[3].length;c++){this.gressarr[3][c]=1}var e=$(a).find("analyzer-port");if(e.length==0){this.status="Disable"}else{this.status="Enable"}this.sel_group.change(function(){g.changeGroup()});this.sel_status.change(function(){if(g.sel_status.val()=="Enable"){g.enableAll()}else{g.disableAll()}});this.createTable1();var b=$(a).find("mirrored-port:first");if(b.length>0&&b.children().length>0){var g=this;var f=b.find("port");f.each(function(){var k=$.trim($(this).find("id").text());var h=k.split("/")[1];trace("num="+h+",id="+k);var j=$.trim($(this).find("direction").text());trace("direction="+j);switch(j){case"Ingress":g.ingress_str+=k+",";g.gressarr[0][h]=1;g.gressarr[3][h]=0;break;case"Egress":g.egress_str+=k+",";g.gressarr[1][h]=1;g.gressarr[3][h]=0;break;case"Both":g.both_str+=k+",";g.gressarr[2][h]=1;g.gressarr[3][h]=0;break}})}this.createTable2();this.createTable3();if(this.status=="Disable"){this.disableAll()}},genreateDOM:function(){for(var b=1;b<=RouterConfig.portnum;b++){this.sel_analy_port1.append('<option value="'+b+'">'+RouterConfig.prefix+"/"+b+"</option>");this.sel_analy_port2.append('<option value="'+b+'">'+RouterConfig.prefix+"/"+b+"</option>");this.trArr[0].append('<th class="wd25">'+b+"</th>");for(var a=1;a<this.trArr.length;a++){this.trArr[a].append('<th class="wd25"><input type="radio" class="taArr'+a+'" name="gressradio'+b+'" value="'+this.radiomap2[a-1]+"_"+b+'" /></th>')}}},createTable1:function(){var c=this;this.makeSelect(this.sel_group,this.group);this.makeSelect(this.sel_status,this.status);var a=$(this.result).find("analyzer-port:first");if(a.length>0&&a.children().length>0){var b=$(a).find("port");b.each(function(d){var f=$.trim($(this).find("id").text()).split("/")[1];var e=$.trim($(this).find("direction").text());c.analyarr[(d+1)]=f;c.analyPort((d+1),f);c.direction((d+1),e)})}this.sel_analy_port1.change(function(){var d=c.sel_analy_port1.val();c.analyPort(1,d)});this.sel_analy_port2.change(function(){var d=c.sel_analy_port2.val();c.analyPort(2,d)});this.sel_analy_dir1.change(function(){var d=c.sel_analy_dir1.val();c.direction(1,d)});this.sel_analy_dir2.change(function(){var d=c.sel_analy_dir2.val();c.direction(2,d)})},analyPort:function(a,c){var b=(a==1?2:1);if(c!=""&&c==this.analyarr[b]){alert("analyzer-port must different!");this.makeSelect(this["sel_analy_port"+a],"");return}this.makeSelect(this["sel_analy_port"+a],c);if(this.analyarr[a]!=""&&this.analyarr[1]!=this.analyarr[2]){this.enableRadio(this.analyarr[a])}this.analyarr[a]=c;if(c==""){this.direction(a,c)}else{this.disableRadio(this.analyarr[a])}this.makeText()},direction:function(a,b){this.makeSelect(this["sel_analy_dir"+a],b);var c=(a==1?2:1);if(b=="Both"){this["sel_analy_port"+c].attr("disabled",true).val("");this["sel_analy_dir"+c].attr("disabled",true).val("");this.enableRadio(this.analyarr[c])}else{this["sel_analy_port"+c].removeAttr("disabled");this["sel_analy_dir"+c].removeAttr("disabled");this.disableRadio(this.analyarr[c])}this.makeText()},enableRadio:function(b){var c=document.getElementsByName("gressradio"+b);for(var a=0;a<c.length;a++){$(c[a]).removeAttr("disabled");$(c[a]).attr("checked")?this.gressarr[a][b]=1:this.gressarr[a][b]=0}},disableRadio:function(b){var c=document.getElementsByName("gressradio"+b);for(var a=0;a<c.length;a++){$(c[a]).attr("disabled",true);a==3?this.gressarr[a][b]=1:this.gressarr[a][b]=0;a==3?$(c[a]).attr("checked",true):""}},createTable2:function(){trace("createTable2");trace(this.gressarr);var d=this;for(var b=0;b<this.gressarr.length;b++){var c=$("input.taArr"+(b+1));for(var a=0;a<c.length;a++){if(d.gressarr[b][a+1]==1){$(c[a]).attr("checked",true)}}c.each(function(){$(this).click(function(){var f=$(this).val();var h=f.split("_")[0];var g=f.split("_")[1];for(var e=0;e<d.gressarr.length;e++){d.gressarr[e][g]=0}d.gressarr[d.radiomap[h]][g]=1;d.makeText()})})}},makeText:function(){for(var c in this.radiomap2){this[this.radiomap2[c]+"_str"]=""}trace(this.gressarr);for(var e=0;e<this.gressarr.length;e++){var b=this.gressarr[e];for(var d=0;d<b.length;d++){if(b[d]==1){this[this.radiomap2[e]+"_str"]+=this.prefix+"/"+d+","}}}this.createTable3()},createTable3:function(){this.ingress_text.val(this.ingress_str.replace(/,$/i,""));this.egress_text.val(this.egress_str.replace(/,$/i,""));this.both_text.val(this.both_str.replace(/,$/i,""))},makeSelect:function(b,a){$(b).val(a)},changeGroup:function(){var b=$("#sel_group").val();var a=location.href;if(b!=""){a=PM.setPara(a,"group",b)}else{a=PM.removePara(a,"group")}window.location.href=a},disableAll:function(){for(var a=1;a<3;a++){this["sel_analy_port"+a].val("");this["sel_analy_dir"+a].val("");this["sel_analy_port"+a].attr("disabled",true);this["sel_analy_dir"+a].attr("disabled",true)}for(var a=1;a<=this.length;a++){this.disableRadio(a)}this.makeText();return},enableAll:function(){$("input").each(function(){$(this).removeAttr("disabled")});$("select").each(function(){$(this).removeAttr("disabled")})},submit:function(){var a=RouterConfig.commit;a+=decodeURIComponent($.param({dispatch:"cfg-mirror",group:this.sel_group.val(),status:this.sel_status.val(),r:Math.random()}));if(this.sel_status.val()=="disable"){this.commit(a);return}var b="";if(!this.sel_analy_port1.attr("disabled")&&this.sel_analy_port1.val()!=""){a+="&"+decodeURIComponent($.param({analyzer_port1:this.prefix+"/"+this.sel_analy_port1.val()}));if(this.sel_analy_dir1.val()==""){alert($("#dir_tips").val());return}b=this.sel_analy_dir1.val();a+="&"+decodeURIComponent($.param({direction1:this.sel_analy_dir1.val()}))}if(!this.sel_analy_port2.attr("disabled")&&this.sel_analy_port2.val()!=""){a+="&"+decodeURIComponent($.param({analyzer_port2:this.prefix+"/"+this.sel_analy_port2.val()}));if(this.sel_analy_dir2.val()==""||b==this.sel_analy_dir2.val()){alert($("#dir_tips").val());return}a+="&"+decodeURIComponent($.param({direction2:this.sel_analy_dir2.val()}))}a+="&"+decodeURIComponent($.param({ingress_mirrored_port:this.ingress_text.val(),egress_mirrored_port:this.egress_text.val(),both_mirrored_port:this.both_text.val()}));PM.disableButton();this.commit(a)},commit:function(a){$.ajax({url:a,type:"GET",dataType:"xml"}).done(function(b){manageResult(b)})}};PortIsolation=PM.create();PortIsolation.prototype={initialize:function(a,d){var e=this;this.radiomap={ingress:0,egress:1,both:2,none:3};this.radiomap2={"0":"ingress","1":"egress","2":"both"};this.group=d.group;this.table1=d.table1;this.table2=d.table2;this.table3=d.table3;this.result=a;this.prefix=RouterConfig.prefix;this.length=RouterConfig.portnum;this.ingress_str="";this.egress_str="";this.both_str="";this.ingress_text=$("#ingress_text");this.egress_text=$("#egress_text");this.both_text=$("#both_text");this.analyarr=new Array(3);this.gressarr=[new Array((this.length+1)),new Array((this.length+1)),new Array((this.length+1)),new Array((this.length+1))];for(var b=0;b<this.gressarr[3].length;b++){this.gressarr[3][b]=1}var c=$(a).find("group");if(c.length==0){this.status="Disable"}else{this.status="Enable"}this.sel_group=$("#sel_group");this.sel_group.change(function(){e.changeGroup()});this.sel_status=$("#sel_status");this.sel_status.change(function(){if(e.sel_status.val()=="Enable"){e.enableAll()}else{e.disableAll()}});if(this.status=="Disable"){this.disableAll()}this.sel_analy_port1=$("#sel_analy_port1");this.sel_analy_port2=$("#sel_analy_port2");this.sel_analy_dir1=$("#sel_analy_dir1");this.sel_analy_dir2=$("#sel_analy_dir2");this.createTable1();$(this.result).find("group").each(function(){var f=$(this).find("id");var h=$(this).find("uplink-port-list");var g=$(this).find("isol-port-list");h.each(function(){$(this).find("port").each(function(){var k=$.trim($(this).text());var j=k.split("/")[1];e.ingress_str+=k+",";e.gressarr[0][j]=1;e.gressarr[3][j]=0})});g.each(function(){$(this).find("port").each(function(){var k=$.trim($(this).text());var j=k.split("/")[1];e.egress_str+=k+",";e.gressarr[1][j]=1;e.gressarr[3][j]=0})})});trace("this.ingress_str="+this.ingress_str);trace("this.egress_str="+this.egress_str);this.createTable2();this.createTable3()},createTable1:function(){var a=this;trace("this.group="+this.group);this.makeSelect(this.sel_group,this.group);this.makeSelect(this.sel_status,this.status)},analyPort:function(a,b){},direction:function(a,b){},disableAll:function(){for(var a=1;a<=this.length;a++){this.disableRadio(a)}},enableAll:function(){$("input").each(function(){$(this).removeAttr("disabled")});$("select").each(function(){$(this).removeAttr("disabled")})},submit:function(){var a=RouterConfig.port_isolation;a=PM.setPara(a,"dispatch","cfg-isol");a=PM.setPara(a,"group",this.sel_group.val());a=PM.setPara(a,"status",this.sel_status.val());a=PM.setPara(a,"r",Math.random());if(this.sel_status.val()=="Disable"){this.commit(a);return}else{if(this.sel_status.val()==""){alert($("#statuserr").val());return}}a=PM.setPara(a,"uplink-port-list",this.ingress_text.val());a=PM.setPara(a,"isol-port-list",this.egress_text.val());this.commit(a)},commit:function(a){$.ajax({url:a}).done(function(b){manageResult(b)})}};$extend(PortIsolation.prototype,PortMirror.prototype,true);var Dialog=PM.create();Dialog.prototype={_template:{"default":['<table id="dialog_table_{id}" class="CP_w" style="display:none;left: {left}px; top: {top}px; z-index: 1024; position: absolute; opacity: 1;">','<thead style=" -moz-user-select: none;">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">',"<strong>{title}</strong>",'<cite><a id="btnClose_{id}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="content_{id}" class="CP_layercon2" style="width:{width}px; height:{height}px;">',"{content}","</div>","</td>",'<td class="tRight"><span></span>',"</td>","</tr>","</tbody>","</table>"].join(""),confirm:['<table id="dialog_table_{id}" class="CP_w" style="display:none;left: {left}px; top: {top}px; z-index: 1024; position: absolute; opacity: 1;">','<thead id="titleBar_{id}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="titleName_{id}">{title}</strong><cite><a id="btnClose_{id}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="content_{id}" class="CP_layercon1" style="width:{width}px; height:{height}px;" >','<div class="CP_prompt">','<cite id="icon_{id}" class="SG_icon SG_icon2{icon}" style="width:50px;height:50px"></cite>','<table class="CP_w_ttl"><tr><td id="text_{id}">{content}</td></tr></table>','<div id="subText_{id}" class="CP_w_cnt SG_txtb">{subContent}</div>','<p class="CP_w_btns">','<a  id="linkOk_{id}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="btnOk_{id}">{textOk}</cite></a>','<a  style="margin-left:15px;" id="linkCancel_{id}" class="SG_aBtn {cancelStyle}" href="#" onclick="return false;"><cite id="btnCancel_{id}">{textCancel}</cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),alert:['<table id="dialog_table_{id}" class="CP_w" style="display:none;left: {left}px; top: {top}px; z-index: 1024; position: absolute; opacity: 1;">','<thead id="titleBar_{id}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="titleName_{id}">{title}</strong><cite><a id="btnClose_{id}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="content_{id}" class="CP_layercon1">','<div class="CP_prompt">','<cite id="icon_{id}" class="SG_icon SG_icon2{icon}" style="width:50px;height:50px"></cite>','<table class="CP_w_ttl"><tr><td id="text_{id}">{content}</td></tr></table>','<div id="subText_{id}" class="CP_w_cnt SG_txtb">{subContent}</div>','<p class="CP_w_btns_Mid"><a id="linkOk_{id}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="btnOk_{id}">{textOk}</cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),nobtn:['<table id="dialog_table_{id}" class="CP_w" style="display:none;left: {left}px; top: {top}px; z-index: 1024; position: absolute; opacity: 1;">','<thead id="titleBar_{id}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="titleName_{id}">{title}</strong></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="content_{id}" class="CP_layercon1">','<div class="CP_prompt">','<cite id="icon_{id}" class="SG_icon SG_icon2{icon}" style="width:50px;height:50px"></cite>','<table class="CP_w_ttl"><tr><td id="text_{id}">{content}</td></tr></table>','<div id="subText_{id}" class="CP_w_cnt SG_txtb">{subContent}</div>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),custom:['<table id="dialog_table_{id}" class="CP_w" style="display:none;left: {left}px; top: {top}px; z-index: 1024; position: absolute; opacity: 1;">',"<tr>",'<td id="dialog_container_{id}">',"{content}","</td>","</tr>","</table>"].join(""),iframe:['<table id="dialog_table_{id}" class="CP_w" style="display:none;left: {left}px; top: {top}px; z-index: 1024; position: absolute; opacity: 1;">','<thead style=" -moz-user-select: none;">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">',"<strong>{title}</strong>",'<cite><a id="btnClose_{id}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="content_{id}" style="width:{width}px; height:{height}px;">',"{content}","</div>","</td>",'<td class="tRight"><span></span>',"</td>","</tr>","</tbody>","</table>"].join("")},initialize:function(a){if(this.created==true){this.show()}this.created=true;this.createMask();this.createDialog(a)},$c:function(a){return document.createElement(a)},$e:function(a){return document.getElementById(a)},createMask:function(){this._id=new Date().getTime();var a=this.$c("div");a.className="dialog_mask";a.id="dialog_mask_"+this.getId();document.body.appendChild(a)},createDialog:function(a){var d=a||{};d.title=d.title||"";this._closeFunc=d.closeFunc||function(){};this._confirmFunc=d.confirmFunc||function(){};this._cancelFunc=d.cancelFunc||function(){};d.width=d.width||"600";d.height=d.height||"300";d.left=d.left||"50";d.top=d.top||"200";d.content=d.content||"";d.type=d.type||"default";d.id=this.getId();this.isDestory=d.isDestory||false;if(d.type=="confirm"||d.type=="alert"){d.icon=a.icon||"01";d.textOk=a.textOk||"OK";d.textCancel=a.textCancel||"CANCAL";d.cancelStyle=a.cancelStyle||"SG_aBtn"}if(d.content){d.content=this.substitute(d.content,{id:this.getId()})}var c=this.getTemplate(d.type);var b=this.substitute(c,d);this.insertHTML(document.body,b,"BeforeEnd");this.bindEvent()},bindEvent:function(){var a=this.getId();this.mask=this.$e("dialog_mask_"+a);this.dialog=this.$e("dialog_table_"+a);this.closeBtn=this.$e("btnClose_"+a);this.linkOk=this.$e("linkOk_"+a);this.linkCancel=this.$e("linkCancel_"+a);if(this.closeBtn){this.addEvent(this.closeBtn,this._closeFunc);this.addEvent(this.closeBtn,this.bindFunc(this.hide,this))}if(this.linkOk){this.addEvent(this.linkOk,this.bindFunc(this.hide,this));this.addEvent(this.linkOk,this._confirmFunc)}if(this.linkCancel){this.addEvent(this.linkCancel,this.bindFunc(this.hide,this));this.addEvent(this.linkCancel,this._cancelFunc)}},bindFunc:function(b,c){var a=b;return function(){return a.apply(c,arguments)}},addEvent:function(f,d,c,a){var e=typeof f=="string"?this.$e(f):f;if(e==null){trace("addEvent 找不到对象："+f);return}if(typeof a=="undefined"){a=false}if(typeof c=="undefined"){c="click"}if(e.addEventListener){e.addEventListener(c,d,a);return true}else{if(e.attachEvent){var b=e.attachEvent("on"+c,d);return true}else{e["on"+c]=d}}},getId:function(){return this._id},getTemplate:function(a){return this._template[a]},setContainer:function(a){var b=this.getId();this.container=this.$e("dialog_container_"+b);if(this.container){this.container.innerHTML=a}},show:function(){this.mask.style.display="block";this.dialog.style.display="block";return this},hide:function(){if(this.isDestory){this.destroy()}else{this.mask.style.display="none";this.dialog.style.display="none"}},destroy:function(){this.dialog.parentNode.removeChild(this.dialog);this.mask.parentNode.removeChild(this.mask)},insertHTML:function(d,c,b){d=d||document.body;b=b.toLowerCase()||"beforeend";if(d.insertAdjacentHTML){switch(b){case"beforebegin":d.insertAdjacentHTML("BeforeBegin",c);return d.previousSibling;case"afterbegin":d.insertAdjacentHTML("AfterBegin",c);return d.firstChild;case"beforeend":d.insertAdjacentHTML("BeforeEnd",c);return d.lastChild;case"afterend":d.insertAdjacentHTML("AfterEnd",c);return d.nextSibling}}var a=d.ownerDocument.createRange();var e;switch(b){case"beforebegin":a.setStartBefore(d);e=a.createContextualFragment(c);d.parentNode.insertBefore(e,d);return d.previousSibling;case"afterbegin":if(d.firstChild){a.setStartBefore(d.firstChild);e=a.createContextualFragment(c);d.insertBefore(e,d.firstChild);return d.firstChild}else{d.innerHTML=c;return d.firstChild}break;case"beforeend":if(d.lastChild){a.setStartAfter(d.lastChild);e=a.createContextualFragment(c);d.appendChild(e);return d.lastChild}else{d.innerHTML=c;return d.lastChild}break;case"afterend":a.setStartAfter(d);e=a.createContextualFragment(c);d.parentNode.insertBefore(e,d.nextSibling);return d.nextSibling}},substitute:function(a,g,f){if(!(Object.prototype.toString.call(g)==="[object Array]")){g=[g]}var c=[];for(var d=0,b=g.length;d<b;d++){c.push(e(g[d]))}return c.join("");function e(h){return a.replace(f||(/\\?\{([^}]+)\}/g),function(k,j){if(k.charAt(0)=="\\"){return k.slice(1)}return(h[j]!=undefined)?h[j]:""})}}};